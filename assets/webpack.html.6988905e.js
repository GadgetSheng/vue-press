import{r as e,o,c as l,a as n,e as p,w as t,F as c,b as s,d as r}from"./app.8af49527.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";var i="/vue-press/assets/HMR-principal.1526aa68.png";const k={},b=n("h1",{id:"\u5B66\u4E60webpack",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5B66\u4E60webpack","aria-hidden":"true"},"#"),s(" \u5B66\u4E60webpack")],-1),d={class:"table-of-contents"},m=s("Original"),g=s("Concepts"),y=s("Entry"),v=s("Output"),h=s("Plugins"),w=s("Mode"),f=s("Browser Compatibility"),x=s("Scenarios"),j=s("Multiple Entry Points"),_=s("Webpack\u5185\u5BB9\u7EFC\u8FF0"),q=s("01 webpack\u4E0E\u6784\u5EFA\u53D1\u5C55\u7B80\u53F2"),S=s("02 webpack\u57FA\u7840\u7528\u6CD5"),C=s("03 webpack\u8FDB\u9636\u7528\u6CD5"),P=s("04 \u7F16\u5199\u53EF\u7EF4\u62A4\u7684webpack\u6784\u5EFA\u914D\u7F6E"),E=s("05 Webpack\u6784\u5EFA\u901F\u5EA6\u548C\u4F53\u79EF\u4F18\u5316\u7B56\u7565"),M=s("06 \u901A\u8FC7\u6E90\u7801\u638C\u63E1webpack\u6253\u5305\u539F\u7406"),N=s("07 \u7F16\u5199Loader\u63D2\u4EF6"),T=r(`<h2 id="original" tabindex="-1"><a class="header-anchor" href="#original" aria-hidden="true">#</a> Original</h2><details class="custom-container details"><summary>\u5B98\u65B9\u539F\u6587</summary><h3 id="concepts" tabindex="-1"><a class="header-anchor" href="#concepts" aria-hidden="true">#</a> Concepts</h3><p>webpack is a <strong>static</strong> module bundler for modern JavaScript application</p><p>it internally builds a [<code>dependency graph</code>] from one or more entry points and then combines every module your project needs into one or more bundles, which are static assets to serve your content from.</p><p>Core concepts:</p><ul><li>Entry</li><li>Output</li><li>Loaders</li><li>Plugins</li><li>Mode</li><li>Browser Compatiblity</li></ul><p>\u4E00\u671F\u76EE\u6807\u95EE\u9898</p><ul><li>Manually Bundling an Application</li><li>Live Coding a Simple Module Bundler</li><li>Detailed Explaination of a Simple Module Bundler</li></ul><h3 id="entry" tabindex="-1"><a class="header-anchor" href="#entry" aria-hidden="true">#</a> Entry</h3><p>entry point = which module webpack begin building out its internal <strong>dependency graph</strong>. figure out depends on(directly or indirectly).</p><p><code>./src/index.js</code></p><h3 id="output" tabindex="-1"><a class="header-anchor" href="#output" aria-hidden="true">#</a> Output</h3><p>emit the bundles and specific the names of these files. <code>./dist/main.js</code> { path, filename }</p><h3 id="plugins" tabindex="-1"><a class="header-anchor" href="#plugins" aria-hidden="true">#</a> Plugins</h3><p>leveraged to perform a wider range of tasks like bundle optimization , asset management and injection of enviroment variables. <em>extend capabilities</em></p><ul><li>require it</li><li>push to plugins array</li><li>create instance with <code>new</code></li></ul><h3 id="mode" tabindex="-1"><a class="header-anchor" href="#mode" aria-hidden="true">#</a> Mode</h3><p>development,<code>production</code>,none built-in optimization that correspond to each environment.</p><h3 id="browser-compatibility" tabindex="-1"><a class="header-anchor" href="#browser-compatibility" aria-hidden="true">#</a> Browser Compatibility</h3><p>supports all &quot;ES5-compliant&quot; webpack needs Promise for <code>import()</code>,<code>require.ensure()</code>. to support older browser you need to load polyfill.</p><blockquote><p>Webpack 5 runs on Node.js version 10.13.0+</p></blockquote><h3 id="scenarios" tabindex="-1"><a class="header-anchor" href="#scenarios" aria-hidden="true">#</a> Scenarios</h3><ol><li>Seperate App and Vender Entries</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        main<span class="token operator">:</span> &#39;xxx&#39;<span class="token punctuation">,</span>
        vendor<span class="token operator">:</span> &#39;yyy&#39;
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> &#39;<span class="token punctuation">[</span>name<span class="token punctuation">]</span>.<span class="token punctuation">[</span>contenthash<span class="token punctuation">]</span>.bundle.js&#39;<span class="token punctuation">,</span> <span class="token comment">// prod</span>
        filename<span class="token operator">:</span> &#39;<span class="token punctuation">[</span>name<span class="token punctuation">]</span>.bundle.js&#39; <span class="token comment">// dev</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>optimization.splitChunks</code> option takes care of seperating vendors and app modules.</p><h3 id="multiple-entry-points" tabindex="-1"><a class="header-anchor" href="#multiple-entry-points" aria-hidden="true">#</a> Multiple Entry Points</h3><p>Output has a unique name. can use substitutions <code>[name]</code></p></details><h2 id="webpack\u5185\u5BB9\u7EFC\u8FF0" tabindex="-1"><a class="header-anchor" href="#webpack\u5185\u5BB9\u7EFC\u8FF0" aria-hidden="true">#</a> Webpack\u5185\u5BB9\u7EFC\u8FF0</h2><div class="custom-container tip"><p class="custom-container-title">\u7AE0\u8282</p><ul><li>P1-P3 webpack \u7684\u57FA\u672C\u6982\u5FF5\u548C\u65E5\u5E38\u5F00\u53D1\u7684\u4F7F\u7528\u6280\u5DE7</li><li>P4-P5 \u4EE5\u5DE5\u7A0B\u5316\u7684\u65B9\u5F0F\u7EC4\u7EC7webpack\u6784\u5EFA\u914D\u7F6E\uFF0C\u548Cwebpack\u6253\u5305\u4F18\u5316</li><li>P6-P7 \u8BE6\u7EC6\u5256\u6790webpack\u6253\u5305\u539F\u7406\u548C\u63D2\u4EF6\uFF0C\u4EE5\u53CAloader\u7684\u5B9E\u73B0</li><li>P8 \u4ECE\u5B9E\u9645web\u5546\u57CE\u9879\u76EE\u51FA\u53D1\uFF0C\u8BB2\u89E3webpack\u5B9E\u9645\u4F7F\u7528</li></ul></div><h3 id="_01-webpack\u4E0E\u6784\u5EFA\u53D1\u5C55\u7B80\u53F2" tabindex="-1"><a class="header-anchor" href="#_01-webpack\u4E0E\u6784\u5EFA\u53D1\u5C55\u7B80\u53F2" aria-hidden="true">#</a> 01 webpack\u4E0E\u6784\u5EFA\u53D1\u5C55\u7B80\u53F2</h3><p>\u4E3A\u4EC0\u4E48\u9700\u8981\u6784\u5EFA\u5DE5\u5177</p><ul><li>\u8F6C\u6362ES6\u8BED\u6CD5</li><li>\u8F6C\u6362JSX</li><li>CSS\u524D\u7F00\u8865\u5168/\u9884\u5904\u7406\u5668</li><li>\u538B\u7F29\u6DF7\u6DC6</li><li>\u56FE\u7247\u538B\u7F29</li></ul><p>\u6784\u5EFA\u6F14\u53D8\u4E4B\u8DEF <code>ant+YUI tool --&gt; grunt --&gt; fis3/gulp --&gt; rollup,webpack,parcel</code></p><p>\u4E3A\u4EC0\u4E48\u9009\u62E9webpack</p><ul><li>\u793E\u533A\u751F\u6001\u4E30\u5BCC</li><li>\u914D\u7F6E\u7075\u6D3B\u548C\u63D2\u4EF6\u5316\u6269\u5C55</li><li>\u5B98\u65B9\u66F4\u65B0\u8FED\u4EE3\u901F\u5EA6\u5FEB</li></ul><p>\u521D\u8BC6webpack\uFF1A\u914D\u7F6E\u6587\u4EF6\u540D\u79F0</p><ul><li>webpack\u9ED8\u8BA4\u914D\u7F6E\u6587\u4EF6 <code>webpack.config.js</code></li><li>\u53EF\u4EE5\u901A\u8FC7 webpack --config \u6307\u5B9A\u914D\u7F6E\u6587\u4EF6</li></ul><p>\u521D\u8BC6webpack\uFF1A\u914D\u7F6E\u7EC4\u6210</p><ul><li>entry // \u6253\u5305\u7684\u5165\u53E3\u6587\u4EF6</li><li>output // \u6253\u5305\u7684\u8F93\u51FA</li><li>mode // \u73AF\u5883</li><li>module.rules // Loader\u914D\u7F6E</li><li>module.plugins // \u63D2\u4EF6\u914D\u7F6E</li></ul><p><strong>\u96F6\u914D\u7F6E</strong>webpack\u5305\u542B\u54EA\u4E9B\u5185\u5BB9</p><ul><li>\u9ED8\u8BA4entry\u4E3A ./src/index.js</li><li>\u9ED8\u8BA4output\u4E3A ./dist/main.js</li><li>loader raw-loader</li><li>plugins HtmlwebpackPlugin template:./src/index.html</li></ul><p>\u73AF\u5883\u642D\u5EFA Node.js \u548C NPM</p><p>\u5B89\u88C5webpack\u548C webpack-cli</p><p>webpack\u521D\u4F53\u9A8C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>---&gt;\u6784\u5EFA\u7ED3\u679C</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">doctype</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dist/bundle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>\u901A\u8FC7npm script \u8FD0\u884C<code>webpack</code></p><p><strong>\u539F\u7406</strong> \u6A21\u5757\u5C40\u90E8\u5B89\u88C5\u4F1A\u5728 node_modules/.bin\u76EE\u5F55\u521B\u5EFA\u8F6F\u94FE\u63A5</p></blockquote><h3 id="_02-webpack\u57FA\u7840\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#_02-webpack\u57FA\u7840\u7528\u6CD5" aria-hidden="true">#</a> 02 webpack\u57FA\u7840\u7528\u6CD5</h3><p>Entry \u7528\u6765\u6307\u5B9Awebpack\u7684\u6253\u5305\u5165\u53E3</p><p>\u6A21\u5757\u4F9D\u8D56\u56FE\u7684\u5165\u53E3\u662F entry \u5BF9\u4E8E\u975E\u4EE3\u7801\u6BD4\u5982\u56FE\u7247\u3001\u5B57\u4F53\u4F9D\u8D56\u4E5F\u4F1A\u4E0D\u65AD\u52A0\u5165\u5230\u4F9D\u8D56\u56FE\u4E2D</p><p>Entry\u7684\u7528\u6CD5</p><ul><li>\u5355\u5165\u53E3\uFF1Aentry\u662F\u4E00\u4E2A\u5B57\u7B26\u4E32</li><li>\u591A\u5165\u53E3\uFF1Aentry\u662F\u4E00\u4E2A\u5BF9\u8C61</li></ul><p>Output\u7528\u6765\u544A\u8BC9webpack \u5982\u4F55\u5C06\u7F16\u8BD1\u540E\u7684\u6587\u4EF6\u8F93\u51FA\u5230\u78C1\u76D8</p><p>Output\u7684\u7528\u6CD5\uFF1A\u5355\u5165\u53E3\u914D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">&#39;./path/to/my/entry/file.js&#39;</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">&#39;/dist&#39;</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Output\u7684\u7528\u6CD5\uFF1A\u591A\u5165\u53E3\u914D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">&#39;./src/app.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">search</span><span class="token operator">:</span> <span class="token string">&#39;./src/search.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">&#39;/dist&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>\u901A\u8FC7\u5360\u4F4D\u7B26\u786E\u4FDD\u6587\u4EF6\u540D\u79F0\u7684\u552F\u4E00</p></blockquote><ul><li>\u6838\u5FC3\u6982\u5FF5\u4E4BLoaders</li></ul><p>webpack\u5F00\u7BB1\u5373\u7528\u53EA\u652F\u6301js\u548Cjson\u4E24\u79CD\u6587\u4EF6\u7C7B\u578B\uFF0C\u901A\u8FC7Loaders\u53BB\u652F\u6301\u5176\u4ED6\u6587\u4EF6\u7C7B\u578B\u5E76\u4E14\u628A\u5B83\u4EEC\u8F6C\u5316\u6210\u6709\u6548\u7684\u6A21\u5757\uFF0C \u5E76\u4E14\u53EF\u4EE5\u6DFB\u52A0\u5230\u4F9D\u8D56\u56FE\u4E2D\u3002 \u672C\u8EAB\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u63A5\u53D7\u6E90\u6587\u4EF6\u4F5C\u4E3A\u53C2\u6570\uFF0C\u8FD4\u56DE\u8F6C\u6362\u7684\u7ED3\u679C\u3002</p><p>\u5E38\u89C1\u7684Loaders</p><table><thead><tr><th>\u540D\u79F0</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>babel-loader</td><td>\u8F6C\u6362ES6+\u7B49JS\u65B0\u7279\u6027\u8BED\u6CD5</td></tr><tr><td>css-loader</td><td>\u652F\u6301.css\u6587\u4EF6\u7684\u52A0\u8F7D\u548C\u89E3\u6790</td></tr><tr><td>less-loader,sass-loader</td><td>...</td></tr><tr><td>ts-loader</td><td>\u5C06ts\u8F6C\u6362\u6210css</td></tr><tr><td>file-loader</td><td>\u8FDB\u884C\u56FE\u7247\u3001\u5B57\u4F53\u7B49\u7684\u6253\u5305</td></tr><tr><td>raw-loader</td><td>\u5C06\u6587\u4EF6\u4EE5\u5B57\u7B26\u4E32\u7684\u5F62\u5F0F\u5BFC\u5165</td></tr><tr><td>thread-loader</td><td>\u591A\u8FDB\u7A0B\u6253\u5305JS\u548CCSS</td></tr></tbody></table><p>Loaders \u7684\u7528\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.txt$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&#39;raw-loader&#39;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p><code>test</code> \u6307\u5B9A\u5339\u914D\u89C4\u5219,<code>use</code> \u6307\u5B9A\u4F7F\u7528\u7684loader\u540D\u79F0</p></blockquote><ul><li>\u6838\u5FC3\u6982\u5FF5\u4E4BPlugins</li></ul><p>\u63D2\u4EF6\u7528\u4E8Ebundle\u6587\u4EF6\u7684\u4F18\u5316\uFF0C\u8D44\u6E90\u7BA1\u7406\u5668\u548C\u73AF\u5883\u53D8\u91CF\u7684\u6CE8\u5165 \u4F5C\u7528\u4E8E\u6574\u4E2A\u6784\u5EFA\u8FC7\u7A0B</p><p>\u5E38\u89C1\u7684Plugins\u6709\u54EA\u4E9B?</p><table><thead><tr><th>\u540D\u79F0</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>CommonsChunkPlugin</td><td>\u5C06chunks\u76F8\u540C\u7684\u6A21\u5757\u4EE3\u7801\u63D0\u53D6\u6210\u516C\u5171js</td></tr><tr><td>CleanWebpackPlugin</td><td>\u6E05\u7406\u6784\u5EFA\u76EE\u5F55</td></tr><tr><td>ExtractTextWebpackPlugin</td><td>\u5C06CSS\u4ECEbundle\u6587\u4EF6\u91CC\u63D0\u53D6\u6210\u4E00\u4E2A\u72EC\u7ACB\u7684CSS\u6587\u4EF6</td></tr><tr><td>CopyWebpackPlugin</td><td>\u5C06\u6587\u4EF6\u6216\u8005\u6587\u4EF6\u5939\u62F7\u8D1D\u5230\u6784\u5EFA\u7684\u8F93\u51FA\u76EE\u5F55</td></tr><tr><td>HtmlWebpackPlugin</td><td>\u521B\u5EFAHTML\u6587\u4EF6\u53BB\u627F\u8F7D\u8F93\u51FA\u7684bundle</td></tr><tr><td>UglifyjsWebpackPlugin</td><td>\u538B\u7F29JS</td></tr><tr><td>ZipWebpackPlugin</td><td>\u5C06\u6253\u5305\u51FA\u7684\u8D44\u6E90\u751F\u6210\u4E00\u4E2Azip\u5305</td></tr></tbody></table><p>Plugins\u7684\u7528\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;bundle.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">&#39;./src/index.html&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>\u653E\u5230plugins\u7684\u6570\u7EC4\u91CC\u9762</p></blockquote><ul><li>\u6838\u5FC3\u6982\u5FF5\u4E4BMode Mode\u7528\u6765\u6307\u5B9A\u5F53\u524D\u7684\u6784\u5EFA\u73AF\u5883\u662F: production development\u8FD8\u662Fnone\uFF0C \u8BBE\u7F6Emode\u53EF\u4EE5\u4F7F\u7528webpack\u5185\u7F6E\u7684\u51FD\u6570\uFF0C\u9ED8\u8BA4\u503C\u662Fproduction</li></ul><p>Mode\u7684\u5185\u7F6E\u51FD\u6570\u529F\u80FD</p><table><thead><tr><th>\u9009\u9879</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>development</td><td>\u8BBEp<wbr>rocess.env.NODE_ENV \u7684\u503C\u4E3A development. \u5F00\u542FNamedChunksPlugin+NameModulesPlugin.</td></tr><tr><td>production</td><td>\u8BBEp<wbr>rocess.env.NODE_ENV \u7684\u503C\u4E3A production. \u5F00\u542F&quot;\u4E00\u5806Plugin&quot;</td></tr><tr><td>none</td><td>\u4E0D\u5F00\u542F\u4EFB\u4F55\u4F18\u5316\u9009\u9879</td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">&quot;\u4E00\u5806Plugin&quot;</p><ul><li>FlagDependencyUsagePlugin</li><li>FlagIncludedChunksPlugin</li><li>ModuleConcatentationPlugin</li><li>NoEmitOnErrorsPlugin</li><li>OccurenceOrderPlugin</li><li>SideEffectsFlagPlugin</li><li>TerserPlugin</li></ul></div><p>\u8D44\u6E90\u89E3\u6790: \u89E3\u6790ES6 \u4F7F\u7528babel-loader babel\u7684\u914D\u7F6E\u6587\u4EF6\u662F.babelrc</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span> <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">}</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u589E\u52A0ES6\u7684babel preset\u914D\u7F6E</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/proposal-class-properties&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>\u589E\u52A0ES6 preset\u914D\u7F6E</p></blockquote><p>\u8D44\u6E90\u89E3\u6790: \u89E3\u6790React JSX</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/proposal-class-properties&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>\u589E\u52A0React\u7684 babel-preset \u914D\u7F6E</p></blockquote><p>\u8D44\u6E90\u89E3\u6790: \u89E3\u6790CSS</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>css-loader\u7528\u4E8E\u52A0\u8F7D.css\u6587\u4EF6\uFF0C\u5E76\u4E14\u8F6C\u6362\u6210commonjs\u5BF9\u8C61 style-loader \u5C06\u6837\u5F0F\u901A\u8FC7<code>&lt;style&gt;</code>\u6807\u7B7E\u63D2\u5165\u5230head\u4E2D</p></blockquote><p>\u89E3\u6790Less\u548CSaSS less-loader \u7528\u4E8E\u5C06less\u8F6C\u6362\u6210css \u89E3\u6790\u56FE\u7247 file-loader \u7528\u4E8E\u5904\u7406\u6587\u4EF6 <code>test: /\\.(png|svg|jpg|gif)$/</code> \u89E3\u6790\u5B57\u4F53 file-loader \u4E5F\u53EF\u4EE5\u7528\u4E8E\u5904\u7406\u5B57\u4F53 <code>test: /\\.(woff|woff2|eot|ttf|otf)$/</code> \u4F7F\u7528url-loader url-loader \u4E5F\u53EF\u4EE5\u5904\u7406\u56FE\u7247\u548C\u5B57\u4F53 \u53EF\u4EE5\u8BBE\u7F6E\u8F83\u5C0F\u7684\u8D44\u6E90\u81EA\u52A8base64</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|svg|jpg|git)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;url-loader&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

    <span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>webpack\u4E2D\u7684\u6587\u4EF6\u76D1\u542C</p><p>\u6587\u4EF6\u76D1\u542C\u662F\u5728\u53D1\u73B0\u6E90\u7801\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u81EA\u52A8\u91CD\u65B0\u6784\u5EFA\u51FA\u65B0\u7684\u8F93\u51FA\u6587\u4EF6\u3002</p><p>webpack \u5F00\u542F\u76D1\u542C\u6A21\u5F0F\uFF0C\u6709\u4E24\u79CD\u65B9\u5F0F:</p><ol><li>\u542F\u52A8 webpack\u547D\u4EE4\u65F6\uFF0C\u5E26\u4E0A--watch\u53C2\u6570</li><li>\u5728\u914D\u7F6Ewebpack.config.js\u4E2D\u8BBE\u7F6E watch: true</li></ol><p>\u552F\u4E00\u7F3A\u9677\uFF1A\u6BCF\u6B21\u9700\u8981\u624B\u52A8 \u5237\u65B0\u6D4F\u89C8\u5668</p><details class="custom-container details"><summary>\u6587\u4EF6\u76D1\u542C\u539F\u7406</summary><p>\u8F6E\u8BE2\u5224\u65AD\u6587\u4EF6\u7684\u6700\u540E\u7F16\u8F91\u65F6\u95F4\u662F\u5426\u53D8\u5316 \u67D0\u4E2A\u6587\u4EF6\u53D1\u751F\u4E86\u53D8\u5316\uFF0C\u5E76\u4E0D\u4F1A\u7ACB\u5373\u544A\u8BC9\u76D1\u542C\u8005\uFF0C\u800C\u662F\u5148\u7F13\u5B58\u8D77\u6765\uFF0C\u7B49aggregateTimeout</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//\u9ED8\u8BA4false</span>
    <span class="token literal-property property">watchOptions</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">ignored</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// \u9ED8\u8BA4\u7A7A\uFF0C\u4E0D\u76D1\u542C\u7684\u6587\u4EF6(\u5939),\u652F\u6301\u6B63\u5219\u5339\u914D</span>
        <span class="token literal-property property">aggregateTimeout</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment">// \u76D1\u542C\u5230\u53D8\u5316\u540E\u4F1A\u7B49300ms\u518D\u53BB\u6267\u884C\uFF0C\u9ED8\u8BA4300</span>
        <span class="token literal-property property">poll</span><span class="token operator">:</span><span class="token number">1000</span> <span class="token comment">// \u5224\u65AD\u6587\u4EF6\u662F\u5426\u53D8\u5316\u662F\u901A\u8FC7\u8F6E\u8BE2\u95EE\u7CFB\u7EDF\u6307\u5B9A\u6587\u4EF6\u6709\u6CA1\u53D8\u5316\u5B9E\u73B0\u7684\uFF0C\u9ED8\u8BA4\u6BCF\u79D2\u95EE1000\u6B21</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></details><p>\u70ED\u66F4\u65B0 webpack-dev-server</p><ul><li>WDS \u4E0D\u5237\u65B0\u6D4F\u89C8\u5668</li><li>WDS \u4E0D\u8F93\u51FA\u6587\u4EF6\uFF0C\u800C\u662F\u653E\u5728\u5185\u5B58\u4E2D</li><li>\u4F7F\u7528HotModuleReplacementPlugin\u63D2\u4EF6 <code>webpack-dev-server --open</code></li></ul><p>\u70ED\u66F4\u65B0 \u4F7F\u7528webpack-dev-middleware WDS\u5C06 webpack\u8F93\u51FA\u7684\u6587\u4EF6\u4F20\u8F93\u7ED9\u670D\u52A1\u5668 \u9002\u7528\u4E8E\u7075\u6D3B\u7684\u5B9A\u5236\u573A\u666F</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackDevMiddleware<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-dev-middleware&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack.config.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler<span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">publicPath</span><span class="token operator">:</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;app listening on port 3000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u70ED\u66F4\u65B0\u7684\u539F\u7406\u5206\u6790</p><ul><li>Webpack Compile: \u5C06JS\u7F16\u8BD1\u6210 Bundle</li><li>HMR Server: \u5C06\u70ED\u66F4\u7684\u6587\u4EF6\u8F93\u51FA\u7ED9 HMR Runtime</li><li>Bundle server: \u63D0\u4F9B\u6587\u4EF6\u5728\u6D4F\u89C8\u5668\u7684\u8BBF\u95EE</li><li>HMR Runtime: \u4F1A\u88AB\u6CE8\u5165\u5230\u6D4F\u89C8\u5668\uFF0C\u66F4\u65B0\u6587\u4EF6\u7684\u53D8\u5316</li><li>bundle.js: \u6784\u5EFA\u8F93\u51FA\u7684\u6587\u4EF6</li></ul><p><img src="`+i+`" alt="HMR\u539F\u7406\u5206\u6790"></p><ul><li>\u4EC0\u4E48\u662F\u6587\u4EF6\u6307\u7EB9? \u6253\u5305\u540E\u8F93\u51FA\u7684\u6587\u4EF6\u540D\u7684\u540E\u7F00 hash\u4E32 \u6587\u4EF6\u6307\u7EB9\u5982\u4F55\u751F\u6210</li><li>Hash\uFF1A\u548C\u6574\u4E2A\u9879\u76EE\u7684\u6784\u5EFA\u76F8\u5173\uFF0C\u53EA\u8981\u9879\u76EE\u6587\u4EF6\u6709\u4FEE\u6539\uFF0C\u6574\u4E2A\u9879\u76EE\u6784\u5EFA\u7684hash\u503C\u5C31\u4F1A\u66F4\u6539</li><li>Chunkhash\uFF1A\u548Cwebpack\u6253\u5305\u7684chunk\u6709\u5173\uFF0C\u4E0D\u540C\u7684entry\u4F1A\u751F\u6210\u4E0D\u540C\u7684chunkhash\u503C</li><li>Contenthash: \u6839\u636E\u6587\u4EF6\u5185\u5BB9\u6765\u5B9A\u4E49hash\uFF0C\u6587\u4EF6\u5185\u5BB9\u4E0D\u53D8\uFF0C\u5219contenthash\u4E0D\u53D8</li></ul><p>JS\u7684\u6587\u4EF6\u6307\u7EB9\u8BBE\u7F6E \u8BBE\u7F6Eoutput\u7684filename\uFF0C\u4F7F\u7528[chunkhash] <code>output:{ filename: &#39;[name][chunkhash:8].js&#39; }</code> CSS\u6587\u4EF6\u7684\u6307\u7EB9\u8BBE\u7F6E \u8BBE\u7F6EMiniCssExtractPlugin\u7684filename,\u4F7F\u7528[contenthash]</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[name][contenthash:8].css</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u56FE\u7247\u6587\u4EF6\u7684\u6307\u7EB9\u8BBE\u7F6E \u8BBE\u7F6Efile-loader\u7684name\uFF0C\u4F7F\u7528[hash] <code>use: [{loader:&#39;file-loader&#39;,options:{name:&#39;img/[name][hash:8].[ext]&#39;}}]</code></p><table><thead><tr><th>\u5360\u4F4D\u7B26\u540D\u79F0</th><th>\u542B\u4E49</th></tr></thead><tbody><tr><td>ext</td><td>\u8D44\u6E90\u7684\u540E\u7F00\u540D</td></tr><tr><td>name</td><td>\u6587\u4EF6\u540D\u79F0</td></tr><tr><td>path</td><td>\u6587\u4EF6\u7684\u76F8\u5BF9\u8DEF\u5F84</td></tr><tr><td>folder</td><td>\u6587\u4EF6\u6240\u5728\u7684\u6587\u4EF6\u5939</td></tr><tr><td>contenthash</td><td>\u6587\u4EF6\u7684\u5185\u5BB9hash\uFF0C\u9ED8\u8BA4md5\u751F\u6210</td></tr><tr><td>hash</td><td>\u6587\u4EF6\u5185\u5BB9\u7684Hash,\u9ED8\u8BA4md5\u751F\u6210</td></tr><tr><td>emoji</td><td>\u4E00\u4E2A\u968F\u673A\u7684\u6307\u4EE3\u6587\u4EF6\u5185\u5BB9\u7684emoji</td></tr></tbody></table><p>\u4EE3\u7801\u538B\u7F29 HTML\u538B\u7F29 CSS\u538B\u7F29 JS\u538B\u7F29</p><p>JS\u6587\u4EF6\u7684\u538B\u7F29 \u5185\u7F6E\u4E86uglifyjs-webpack-plugin CSS\u6587\u4EF6\u7684\u538B\u7F29 \u4F7F\u7528optimize-css-assets-webpack-plugin\uFF0C\u540C\u65F6\u4F7F\u7528 cssnano</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">assetsNameRegExp</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">cssProcessor</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;cssnano&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>html\u6587\u4EF6\u7684\u538B\u7F29 \u4FEE\u6539html-webpack-plugin, \u8BBE\u7F6E\u538B\u7F29\u53C2\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;src/search.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;search.html&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;search&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minify</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">html5</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">preserveLineBreaks</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minifyCSS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minifyJS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">removeComments</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token literal-property property">\u7684\u5B9A\u4E49</span><span class="token operator">:</span> font<span class="token operator">-</span>size <span class="token keyword">of</span> the root elementrem \u548C px \u5BF9\u6BD4
\u79FB\u52A8\u7AEF<span class="token constant">CSS</span> px\u81EA\u52A8\u8F6C\u6362\u6210rem
\u4F7F\u7528px2rem<span class="token operator">-</span>loader
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_03-webpack\u8FDB\u9636\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#_03-webpack\u8FDB\u9636\u7528\u6CD5" aria-hidden="true">#</a> 03 webpack\u8FDB\u9636\u7528\u6CD5</h3><ol><li>\u5F53\u524D\u6784\u5EFA\u7684\u95EE\u9898 \u6BCF\u6B21\u6784\u5EFA\u7684\u65F6\u5019\u4E0D\u4F1A\u6E05\u7406\u76EE\u5F55\uFF0C\u9020\u6210\u6784\u5EFA\u7684\u8F93\u51FA\u76EE\u5F55output\u6587\u4EF6\u8D8A\u6765\u8D8A\u591A</li></ol><p>\u901A\u8FC7 npm scripts \u6E05\u7406\u6784\u5EFA\u76EE\u5F55 <code>rm -rf ./dist &amp;&amp; webpack</code><code>rimraf ./dist &amp;&amp; webpack</code></p><p>\u81EA\u52A8\u6E05\u7406\u6784\u5EFA\u76EE\u5F55 \u907F\u514D\u6784\u5EFA\u524D\u6BCF\u6B21\u90FD\u9700\u8981\u624B\u52A8\u5220\u9664dist \u4F7F\u7528clean-webpack-plugin ,\u9ED8\u8BA4\u4F1A\u5220\u9664output\u6307\u5B9A\u7684\u8F93\u51FA\u76EE\u5F55</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> plugins<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">]</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>CSS3\u5C5E\u6027\u4E3A\u4EC0\u4E48\u9700\u8981\u524D\u7F00?</li></ol><ul><li>Trident(-ms)</li><li>Geko(-moz)</li><li>Webkit(-webkit)</li><li>Presto(-o)</li></ul><p>\u4E3E\u4E2A\u4F8B\u5B50</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.box</span><span class="token punctuation">{</span>
    <span class="token property">-moz-border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">-webkit-border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">-o-border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>PostCSS\u63D2\u4EF6 autoprefixer \u81EA\u52A8\u8865\u9F50CSS3\u524D\u7F00 \u4F7F\u7528 autoprefixer \u63D2\u4EF6 \u6839\u636E CanIUse\u89C4\u5219</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> module<span class="token punctuation">.</span>rules<span class="token operator">=</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;postcss-loader&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token function-variable function">plugins</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">[</span>
                    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;autoprefixer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">browsers</span><span class="token operator">:</span><span class="token punctuation">[</span> <span class="token string">&quot;last 2 version&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&gt;1%&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;iOS 7&quot;</span> <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="3"><li>\u6D4F\u89C8\u5668\u7684\u5206\u8FA8\u7387 CSS \u5A92\u4F53\u67E5\u8BE2\u5B9E\u73B0\u54CD\u5E94\u5F0F\u5E03\u5C40</li></ol><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 980px<span class="token punctuation">)</span></span><span class="token punctuation">{</span>
    <span class="token selector">.header</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 900px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 480px<span class="token punctuation">)</span></span><span class="token punctuation">{</span>
    <span class="token selector">.header</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 350px<span class="token punctuation">)</span></span><span class="token punctuation">{</span>
    <span class="token selector">.header</span> <span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="4"><li>rem \u662F\u4EC0\u4E48</li></ol><blockquote><p>W3C \u5BF9 <code>rem</code> \u7684\u5B9A\u4E49: font-size of the root element</p></blockquote><p>rem \u548C px \u5BF9\u6BD4</p><ul><li>rem \u662F\u76F8\u5BF9\u5355\u4F4D</li><li>px \u662F\u7EDD\u5BF9\u5355\u4F4D</li></ul><p>\u79FB\u52A8\u7AEFCSS px\u81EA\u52A8\u8F6C\u6362\u6210rem</p><p>\u4F7F\u7528<code>px2rem-loader</code> \u9875\u9762\u6E32\u67D3\u65F6\u8BA1\u7B97\u6839\u5143\u7D20\u7684font-size\u503C</p><ul><li>\u53EF\u4EE5\u4F7F\u7528\u624B\u6DD8\u7684lib-flexible\u5E93</li><li>https://github.com/amfe/lib-flexible</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rules1<span class="token punctuation">.</span>use<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;px2rem-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
            <span class="token literal-property property">remPecision</span><span class="token operator">:</span> <span class="token number">8</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u8D44\u6E90\u5185\u8054\u7684\u610F\u4E49 \u4EE3\u7801\u5C42\u9762\uFF1A</p><ul><li>\u9875\u9762\u6846\u67B6\u7684\u521D\u59CB\u5316\u811A\u672C</li><li>\u4E0A\u62A5\u76F8\u5173\u6253\u70B9</li><li>css\u5185\u8054\u907F\u514D\u9875\u9762\u95EA\u52A8 \u8BF7\u6C42\u5C42\u9762: \u51CF\u5C11HTTP\u7F51\u7EDC\u8BF7\u6C42\u6570</li><li>\u5C0F\u56FE\u7247\u6216\u8005\u5B57\u4F53\u5185\u8054 url-loader</li></ul><p>HTML \u548C JS \u5185\u8054</p><p>raw-loader \u5185\u8054 html</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;raw-loader!babel-loader!./meta.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>raw-loader \u5185\u8054 js</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">$<span class="token punctuation">{</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;raw-loader!babel-loader!../node_modules/lib-flexible&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>css \u5185\u8054 \u65B9\u6848\u4E00 \u501F\u52A9 style-loader \u65B9\u6848\u4E8C html-inline-css-webpack-plugin</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rules1<span class="token punctuation">.</span>use<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> 
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">insertAt</span><span class="token operator">:</span> <span class="token string">&#39;top&#39;</span><span class="token punctuation">,</span><span class="token comment">// \u6837\u5F0F\u63D2\u5165\u5230&lt;head&gt;</span>
            <span class="token literal-property property">singleton</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// \u5C06\u6240\u6709\u7684style\u6807\u7B7E\u5408\u5E76\u6210\u4E00\u4E2A</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;sass-loader&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u591A\u9875\u9762\u5E94\u7528(PWA)\u6982\u5FF5</p><blockquote><p>\u6BCF\u4E00\u6B21\u9875\u9762\u8DF3\u8F6C\u7684\u65F6\u5019\uFF0C\u540E\u53F0\u670D\u52A1\u5668\u90FD\u4F1A\u7ED9\u8FD4\u56DE\u4E00\u4E2A\u65B0\u7684html\u6587\u6863\uFF0C</p><p>\u8FD9\u79CD\u7C7B\u578B\u7684\u7F51\u7AD9\u4E5F\u5C31\u662F\u591A\u9875\u9762\u7F51\u7AD9\uFF0C\u4E5F\u53EB\u505A\u591A\u9875\u9762\u5E94\u7528</p></blockquote><p>\u591A\u9875\u9762\u6253\u5305\u57FA\u672C\u601D\u8DEF</p><p>\u6BCF\u4E2A\u9875\u9762\u5BF9\u5E94\u4E00\u4E2Aentry\uFF0C\u4E00\u4E2Ahtml-webpack-plugin \u7F3A\u70B9\uFF1A\u6BCF\u6B21\u65B0\u589E\u6216\u5220\u9664\u9875\u9762\u9700\u8981\u6539webpack\u914D\u7F6E</p><p>\u591A\u9875\u9762\u6253\u5305 \u901A\u7528\u65B9\u6848</p><p>\u52A8\u6001\u83B7\u53D6entry \u548C\u8BBE\u7F6E html-webpack-plugin \u5229\u7528 glob.sync</p><ul><li>entry: glob.sync(path.join(__dirname,&#39;./src/*/index.js&#39;)),</li></ul><p>\u4F7F\u7528 source map</p><p>\u4F5C\u7528\uFF1A\u901A\u8FC7source map\u5B9A\u4F4D\u5230\u6E90\u7801</p><ul><li>source map \u79D1\u666E \u962E\u4E00\u5CF0javascript_source_map</li></ul><p>\u5F00\u53D1\u73AF\u5883\u5F00\u542F\uFF0C\u7EBF\u4E0A\u73AF\u5883\u5173\u95ED</p><ul><li>\u7EBF\u4E0A\u6392\u67E5\u95EE\u9898\u7684\u65F6\u5019\u53EF\u4EE5\u5C06sourcemap\u4E0A\u4F20\u5230\u9519\u8BEF\u76D1\u63A7\u7CFB\u7EDF</li></ul><p>source map \u5173\u952E\u5B57</p><p>eval: \u4F7F\u7528eval\u5305\u88F9\u6A21\u5757\u4EE3\u7801</p><p>source map\uFF1A \u4EA7\u751F.map\u6587\u4EF6</p><p>cheap\uFF1A \u4E0D\u5305\u542B\u5217\u4FE1\u606F</p><p>inline\uFF1A \u5C06.map\u4F5C\u4E3ADataURI\u5D4C\u5165\uFF0C\u4E0D\u5355\u72EC\u4EA7\u751F.map\u6587\u4EF6</p><p>module\uFF1A\u5305\u542Bloader\u7684sourcemap</p><p>source map \u7C7B\u578B</p><ul><li>none =prod yes</li><li>eval</li><li>cheap-eval-source-map</li><li>cheap-module-source-map</li><li>eval-source-map</li><li>cheap-source-map =prod yes</li><li>cheap-module-source-map =prod yes</li><li>inline-cheap-source-map</li><li>inline-cheap-module-source-map</li><li>source-map =prod yes</li><li>inline-source-map</li><li>hidden-source-map =prod yes</li></ul><p>\u57FA\u7840\u5E93\u5206\u79BB \u601D\u8DEF\uFF1A\u5C06react\u3001react-dom \u57FA\u7840\u5305\u901A\u8FC7cdn\u5F15\u5165\uFF0C\u4E0D\u6253\u5165bundle\u4E2D \u65B9\u6CD5\uFF1A\u4F7F\u7528html-webpack-externals-plugin</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cosnt plugins<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">externals</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">&#39;//cdn/react.min.js?v=123&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">&#39;//cdn/react-dom.min.js?v=123&#39;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u4F7F\u7528SplitChunksPlugin \u8FDB\u884C\u516C\u5171\u811A\u672C\u5206\u79BB webpack4 \u5185\u7F6E\u7684\uFF0C\u66FF\u4EE3CommonsChunkPlugin \u63D2\u4EF6</p><p>chunks \u53C2\u6570\u8BF4\u660E\uFF1A</p><ul><li>async \u5F02\u6B65\u5F15\u5165\u7684\u5E93\u8FDB\u884C\u5206\u79BB(\u9ED8\u8BA4)</li><li>initial \u540C\u6B65\u5F15\u5165\u7684\u5E93\u8FDB\u884C\u5206\u79BB</li><li>all \u6240\u6709\u5F15\u5165\u7684\u5E93\u8FDB\u884C\u5206\u79BB(\u63A8\u8350)</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
<span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;async&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">&#39;~&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\\\/]node_modules[\\\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u5229\u7528SplitChunksPlugin \u5206\u79BB\u57FA\u7840\u5305</p><p>test: \u5339\u914D\u51FA\u9700\u8981\u5206\u79BB\u7684\u5305</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>optimization<span class="token punctuation">.</span>splitChunks<span class="token punctuation">.</span>cacheGroups<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(react|react-dom)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;vendors&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5229\u7528SplitChunksPlugin \u5206\u79BB\u516C\u5171\u6587\u4EF6</p><p>minChunks: \u8BBE\u7F6E\u6700\u5C0F\u5F15\u7528\u6B21\u6570\u4E3A2\u6B21 minSize\uFF1A\u5206\u79BB\u7684\u5305\u4F53\u79EF\u7684\u5927\u5C0F</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>optimiaztion<span class="token punctuation">.</span>splitChunks<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;commons&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Tree Shaking(\u6447\u6811\u4F18\u5316) \u6982\u5FF5\uFF1A 1\u4E2A\u6A21\u5757\u53EF\u80FD\u6709\u591A\u4E2A\u65B9\u6CD5\uFF0C\u53EA\u8981\u5176\u4E2D\u7684\u67D0\u4E2A\u65B9\u6CD5\u4F7F\u7528\u5230\u4E86\uFF0C\u5219\u6574\u4E2A\u6587\u4EF6\u90FD\u4F1A\u88AB\u6253\u5230bundle\u91CC\u9762\u53BB\uFF0Ctree-shaking\u5C31\u662F\u53EA\u628A\u7528\u5230\u7684\u65B9\u6CD5\u6253\u5165bundle\uFF0C\u6CA1\u7528\u5230\u7684\u65B9\u6CD5\u4F1A\u5728uglify\u9636\u6BB5\u88AB\u64E6\u9664\u6389\u3002</p><p>\u4F7F\u7528\uFF1Awebpack\u9ED8\u8BA4\u652F\u6301\uFF0C\u5728.babelrc\u4E2D\u91CC\u8BBE\u7F6Emodules:false\u5373\u53EF</p><ul><li>production mode\u7684\u60C5\u51B5\u4E0B\u9ED8\u8BA4\u5F00\u542F</li></ul><p>\u8981\u6C42: \u5FC5\u987B\u662FES6\u7684\u8BED\u6CD5,CJS\u7684\u65B9\u5F0F\u4E0D\u652F\u6301</p><p>DCE(Dead code elimination) \u4EE3\u7801\u4E0D\u4F1A\u88AB\u6267\u884C,\u4E0D\u53EF\u5230\u8FBE \u4EE3\u7801\u6267\u884C\u7684\u7ED3\u679C\u4E0D\u4F1A\u88AB\u7528\u5230 \u4EE3\u7801\u53EA\u4F1A\u5F71\u54CD\u6B7B\u53D8\u91CF(\u53EA\u5199\u4E0D\u8BFB)</p><p>Tree-Shanking\u539F\u7406 \u5229\u7528ES6 \u6A21\u5757\u7684\u7279\u70B9:</p><ul><li>\u53EA\u80FD\u4F5C\u4E3A\u6A21\u5757\u9876\u5C42\u7684\u8BED\u53E5\u51FA\u73B0(\u9759\u6001\u7F16\u8BD1)</li><li>import\u7684\u6A21\u5757\u540D\u53EA\u80FD\u662F\u5B57\u7B26\u4E32\u5E38\u91CF</li><li>import binding \u662F immutable\u7684 \u4EE3\u7801\u64E6\u9664:uglify\u9636\u6BB5\u5220\u9664\u65E0\u7528\u4EE3\u7801</li></ul><p>\u73B0\u8C61:\u6784\u5EFA\u540E\u7684\u4EE3\u7801\u5B58\u5728\u5927\u91CF\u95ED\u5305\u4EE3\u7801</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">//a.js</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">&#39;xxxx&#39;</span><span class="token punctuation">;</span>
    <span class="token comment">//b.js</span>
    <span class="token keyword">import</span> index <span class="token keyword">from</span> <span class="token string">&#39;./a&#39;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>---&gt;</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span>__webpack_exports__<span class="token punctuation">,</span>webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
    __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _js_index_WEBPACK_IMPORTED_MODULE_0__<span class="token operator">=</span><span class="token function">__webpack_require__</span><span class="token punctuation">(</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__js_index_WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u4F1A\u5BFC\u81F4\u4EC0\u4E48\u95EE\u9898? \u5927\u91CF\u4F5C\u7528\u57DF\u5305\u88F9\u4EE3\u7801,\u5BFC\u81F4\u4F53\u79EF\u589E\u5927(\u6A21\u5757\u8D8A\u591A\u8D8A\u660E\u663E) \u8FD0\u884C\u4EE3\u7801\u65F6\u521B\u5EFA\u7684\u51FD\u6570\u4F5C\u7528\u57DF\u53D8\u591A,\u5185\u5B58\u5F00\u9500\u53D8\u5927</p><p>\u6A21\u5757\u8F6C\u6362\u5206\u6790</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> helloworld <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./helloworld&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;../../common&#39;</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">helloworld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>---&gt;</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> _common__WEBPACK_IMPORTED_MODULE_0__<span class="token operator">=</span> <span class="token function">__webpack_requrie__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* harmony import */</span> <span class="token keyword">var</span> _common__WEBPACK_IMPORTED_MODULE_1__<span class="token operator">=</span> <span class="token function">__webpack_requrie__</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7ED3\u8BBA:</p><ul><li>\u88ABwebpack\u8F6C\u6362\u540E\u7684\u6A21\u5757\u4F1A\u5E26\u4E0A\u4E00\u5C42\u5305\u88F9</li><li>import \u4F1A\u88AB\u8F6C\u6362\u6210 __webpack_require</li></ul><p>\u8FDB\u4E00\u6B65\u5206\u6790webpack\u7684\u6A21\u5757\u673A\u5236 \u5206\u6790:</p><ul><li>\u6253\u5305\u51FA\u6765\u7684\u662F\u4E00\u4E2AIIFE(\u533F\u540D\u95ED\u5305)</li><li>modules\u662F\u4E00\u4E2A\u6570\u7EC4,\u6BCF\u4E00\u9879\u662F\u4E00\u4E2A\u6A21\u5757\u521D\u59CB\u5316\u51FD\u6570</li><li>__webpack_require \u7528\u6765\u52A0\u8F7D\u6A21\u5757,\u8FD4\u56DE modules.exports</li><li>\u901A\u8FC7<code>WEBPACK_REQUIRE_METHOD(0)</code> \u542F\u52A8\u7A0B\u5E8F</li></ul><p>scope hoisting\u539F\u7406 \u539F\u7406: \u5C06\u6240\u6709\u6A21\u5757\u7684\u4EE3\u7801\u6309\u7167\u5F15\u7528\u987A\u5E8F\u653E\u5728\u4E00\u4E2A\u51FD\u6570\u4F5C\u7528\u57DF\u91CC,\u7136\u540E\u9002\u5F53\u7684\u91CD\u547D\u540D\u4E00\u4E9B\u53D8\u91CF\u4EE5\u9632\u6B62\u53D8\u91CF\u540D\u51B2\u7A81 \u5BF9\u6BD4: \u901A\u8FC7scope hoisting\u53EF\u4EE5\u51CF\u5C11\u51FD\u6570\u58F0\u660E\u4EE3\u7801\u548C\u5185\u5B58\u5F00\u9500 scope hoisting\u4F7F\u7528 webpack mode\u4E3Aproduction \u9ED8\u8BA4\u5F00\u542F \u5FC5\u987B\u662FES6\u8BED\u6CD5 CJS\u4E0D\u652F\u6301</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">const</span> plugins<span class="token operator">=</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4EE3\u7801\u5206\u5272\u7684\u610F\u4E49</p><p>\u5BF9\u4E8E\u5927\u7684web\u5E94\u7528\u6765\u8BB2,\u5C06\u6240\u6709\u7684\u4EE3\u7801\u90FD\u653E\u5728\u4E00\u4E2A\u6587\u4EF6\u4E2D\u663E\u7136\u662F\u4E0D\u591F\u6709\u6548\u7684, \u7279\u522B\u662F\u5F53\u4F60\u7684\u67D0\u4E9B\u4EE3\u7801\u662F\u5728\u67D0\u4E9B\u7279\u6B8A\u7684\u65F6\u5019\u624D\u4F1A\u88AB\u4F7F\u7528\u5230.webapck\u6709\u4E00\u4E2A\u529F\u80FD\u5C31\u662F\u5C06\u4F60\u7684 \u4EE3\u7801\u5E93\u5206\u5272\u6210chunks(\u8BED\u5757),\u5F53\u4EE3\u7801\u8FD0\u884C\u5230\u9700\u8981\u5B83\u4EEC\u7684\u65F6\u5019\u5728\u8FDB\u884C\u52A0\u8F7D.</p><p>\u9002\u7528\u7684\u573A\u666F: \u62BD\u79BB\u76F8\u540C\u4EE3\u7801\u5230\u4E00\u4E2A\u5171\u4EAB\u5757 \u811A\u672C\u61D2\u52A0\u8F7D,\u4F7F\u5F97\u521D\u59CB\u4E0B\u8F7D\u7684\u4EE3\u7801\u66F4\u5C0F</p><p>\u61D2\u52A0\u8F7DJS\u811A\u672C\u7684\u65B9\u5F0F CommonjS: require.ensure ES6: \u52A8\u6001import(\u76EE\u524D\u8FD8\u6CA1\u539F\u751F\u652F\u6301,\u9700\u8981babel\u8F6C\u6362)</p><p>\u5982\u679C\u4F7F\u7528\u52A8\u6001 import? \u5B89\u88C5babel\u63D2\u4EF6 @babel/plugin-syntax-dynamic-import</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> plugins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;@babel/plugin-syntax-dynamic-import&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4EE3\u7801\u5206\u5272\u6548\u679C Assert Size Chunks xxxx.js 176 bytes 2 [emmitted]</p><p>ESLint\u7684\u5FC5\u8981\u6027 \u6848\u4F8B: \u67D0\u624B\u673A\u7CFB\u7EDF\u7684webview\u800C\u6CA1\u6709\u4F7F\u7528X5\u5185\u6838,\u89E3\u6790JSON\u65F6\u9047\u5230\u91CD\u590Dkey\u62A5\u9519,\u5BFC\u81F4\u767D\u5C4F</p><blockquote><p>\u5982\u4F55\u907F\u514D\u7C7B\u4F3C\u4EE3\u7801\u95EE\u9898?</p></blockquote><p>\u884C\u4E1A\u91CC\u4F18\u79C0\u7684 ESLint \u89C4\u8303\u5B9E\u8DF5 \u817E\u8BAF:</p><ul><li>alloyteam \u56E2\u961F-&gt; eslint-config-alloy</li><li>ivweb \u56E2\u961F-&gt; eslint-config-ivweb</li></ul><p>\u5236\u5B9A\u56E2\u961F\u7684ESLint \u89C4\u8303 \u4E0D\u91CD\u590D\u65E9\u8F6E\u5B50,\u57FA\u4E8E eslint:recommend \u914D\u7F6E\u5E76\u6539\u8FDB \u80FD\u591F\u5E2E\u52A9\u53D1\u73B0\u4EE3\u7801\u9519\u8BEF\u7684\u89C4\u5219,\u5168\u90E8\u5F00\u542F \u5E2E\u52A9\u4FDD\u6301\u56E2\u961F\u7684\u4EE3\u7801\u98CE\u683C\u7EDF\u4E00,\u800C\u4E0D\u662F\u9650\u5236\u5F00\u53D1\u4F53\u9A8C</p><p>ESLint\u5982\u4F55\u843D\u5730 \u548CCI/CD\u7CFB\u7EDF\u96C6\u6210,\u548Cwebpack\u96C6\u6210 \u65B9\u6848\u4E00: webpack\u4E0ECI/CD\u96C6\u6210 <strong>CI PIPELINE</strong> \u589E\u52A0 lint pipeline \u672C\u5730\u5F00\u53D1\u9636\u6BB5\u589E\u52A0pre commit\u94A9\u5B50</p><ol><li>\u5B89\u88C5husky</li><li>\u589E\u52A0npm script -&gt; precommit lint-staged</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span> linters<span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;*.{js,scss}&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;eslint --fix&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;git add&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u65B9\u6848\u4E8C: webpack\u4E0EESLint\u96C6\u6210 \u4F7F\u7528eslint-loader,\u6784\u5EFA\u65F6\u68C0\u67E5JS\u89C4\u8303</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>rules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>use<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;eslint-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>webpack\u6253\u5305\u5E93\u548C\u7EC4\u4EF6 webpack\u9664\u4E86\u53EF\u4EE5\u7528\u6765\u6253\u5305\u5E94\u7528,\u4E5F\u53EF\u4EE5\u7528\u6765\u6253\u5305js\u5E93 \u5B9E\u73B0\u4E00\u4E2A\u5927\u6574\u6570\u52A0\u6CD5\u7684\u6253\u5305</p><ul><li>\u9700\u8981\u6253\u5305\u538B\u7F29\u7248\u548C\u975E\u538B\u7F29\u7248\u672C</li><li>\u652F\u6301AMD/CJS/CJS/ESM \u6A21\u5757\u5F15\u5165 \u5E93\u7684\u76EE\u5F55\u7ED3\u6784\u548C\u6253\u5305\u8981\u6C42 \u6253\u5305\u8F93\u51FA\u7684\u5E93\u540D\u79F0:</li><li>\u672A\u538B\u7F29\u7248 large-number.js</li><li>\u538B\u7F29\u7248 large-number.min.js</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>|-/dist
|--large-number.js
|--large-number.min.js
|-webpack.config.js
|-package.json
|-/src
|--index.js
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u652F\u6301\u7684\u4F7F\u7528\u65B9\u5F0F ESM: <code>import * as largeNumber from &#39;large-number&#39;; largeNumber(a,b);</code></p><p>CJS: <code>const largeNumber = require(&#39;large-number&#39;); largeNumber(a,b);</code></p><p>AMD: <code>require([&#39;large-number&#39;],function(largeNumber){ largeNumber(a,b);});</code></p><p>\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7script\u5F15\u5165</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/large-number<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// global variable</span>
    <span class="token function">largeNumber</span><span class="token punctuation">(</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Property in the window object</span>
    window<span class="token punctuation">.</span><span class="token function">largeNumber</span><span class="token punctuation">(</span><span class="token string">&#39;999&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5982\u4F55\u5C06\u5E93\u66B4\u9732\u51FA\u53BB? library: \u6307\u5B9A\u5E93\u7684\u5168\u5C40\u53D8\u91CF libraryTarget: \u652F\u6301\u5E93\u7684\u5F15\u5165\u65B9\u5F0F</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&#39;large-number&#39;</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#39;large-number.min&#39;</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&#39;largeNumber&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">libraryExport</span><span class="token operator">:</span><span class="token string">&#39;default&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span><span class="token string">&#39;umd&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u5982\u4F55\u53EA\u5BF9 .min\u538B\u7F29 \u901A\u8FC7inclue\u8BBE\u7F6E \u53EA\u538B\u7F29min.js \u7ED3\u5C3E\u7684\u6587\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>optimization<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minmizer</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">inclue</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.min\\.js$</span><span class="token regex-delimiter">/</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u8BBE\u7F6E\u5165\u53E3\u6587\u4EF6 package.json\u7684main\u5B57\u6BB5\u4E3A index.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/large-number.min.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">else</span> module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dist/large-number.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u9875\u9762\u6253\u5F00\u8FC7\u7A0B \u670D\u52A1\u7AEF\u6E32\u67D3(SSR)\u662F\u4EC0\u4E48 \u6E32\u67D3:HTML+CSS+JS+Data -&gt; \u6E32\u67D3\u540E\u7684HTML</p><p>\u670D\u52A1\u7AEF: \u6240\u6709\u6A21\u677F\u7B49\u8D44\u6E90\u90FD\u5B58\u5728\u670D\u52A1\u7AEF \u5185\u7F51\u673A\u5668\u62C9\u53D6\u6570\u636E\u66F4\u5FEB \u4E00\u4E2AHTML\u8FD4\u56DE\u6240\u6709\u6570\u636E</p><p>\u6D4F\u89C8\u5668\u548C\u670D\u52A1\u5668\u4EA4\u4E92\u6D41\u7A0B \u8BF7\u6C42\u5F00\u59CB-server-{html-template,data}-serverRender -\u6D4F\u89C8\u5668\u89E3\u6790\u5E76\u6E32\u67D3-\u52A0\u8F7D\u5E76\u6267\u884Cjs\u548C\u5176\u4ED6\u8D44\u6E90-\u9875\u9762\u5B8C\u5168\u53EF\u4EA4\u4E92</p><p>\u5BA2\u6237\u7AEF\u6E32\u67D3vs\u670D\u52A1\u7AEF\u6E32\u67D3</p><table><thead><tr><th></th><th>\u5BA2\u6237\u7AEF\u6E32\u67D3</th><th>\u670D\u52A1\u7AEF\u6E32\u67D3</th></tr></thead><tbody><tr><td>\u8BF7\u6C42</td><td>\u591A\u4E2A\u8BF7\u6C42(HTML,\u6570\u636E\u7B49)</td><td>1\u4E2A\u8BF7\u6C42</td></tr><tr><td>\u52A0\u8F7D\u8FC7\u7A0B</td><td>HTML&amp;\u6570\u636E\u4E32\u884C\u52A0\u8F7D</td><td>1\u4E2A\u8BF7\u6C42\u8FD4\u56DEHTML\u548C\u6570\u636E</td></tr><tr><td>\u6E32\u67D3</td><td>\u524D\u7AEF\u6E32\u67D3</td><td>\u670D\u52A1\u7AEF\u6E32\u67D3</td></tr><tr><td>\u53EF\u4EA4\u4E92</td><td>\u56FE\u7247\u7B49\u9759\u6001\u8D44\u6E90\u52A0\u8F7D\u5B8C\u6210,JS\u903B\u8F91\u6267\u884C\u5B8C\u53EF\u4EA4\u4E92</td><td></td></tr></tbody></table><p>\u603B\u7ED3: \u670D\u52A1\u7AEF\u6E32\u67D3(SSR)\u7684\u6838\u5FC3\u662F\u51CF\u5C11\u8BF7\u6C42</p><p>SSR\u7684\u4F18\u52BF</p><ol><li>\u51CF\u5C11\u767D\u5C4F\u65F6\u95F4</li><li>\u5BF9\u4E8ESEO\u53CB\u597D</li></ol><p>SSR\u4EE3\u7801\u5B9E\u73B0\u601D\u8DEF \u670D\u52A1\u7AEF</p><ul><li>\u4F7F\u7528 react-dom/server\u7684 renderToString \u65B9\u6CD5\u5C06React\u7EC4\u4EF6\u6E32\u67D3\u6210\u5B57\u7B26\u4E32</li><li>\u670D\u52A1\u7AEF\u8DEF\u7531\u8FD4\u56DE\u5BF9\u5E94\u7684\u6A21\u677F \u5BA2\u6237\u7AEF</li><li>\u6253\u5305\u51FA\u9488\u5BF9\u670D\u52A1\u7AEF\u7684\u7EC4\u4EF6</li></ul><p>Webapck ssr\u6253\u5305\u5B58\u5728\u7684\u95EE\u9898 \u6D4F\u89C8\u5668\u5168\u5C40\u53D8\u91CF(Node.js\u4E2D \u6CA1\u6709 document,window);</p><ul><li>\u7EC4\u4EF6\u9002\u914D: \u5C06\u4E0D\u517C\u5BB9\u7684\u7EC4\u4EF6\u6839\u636E\u6253\u5305\u73AF\u5883\u8FDB\u884C\u9002\u914D</li><li>\u8BF7\u6C42\u9002\u914D: \u5C06fetch\u6216\u8005ajax\u53D1\u9001\u8BF7\u6C42\u7684\u5199\u6CD5\u6539\u6210<code>isomorphic-fetch</code>\u6216\u8005<code>axios</code> \u6837\u5F0F\u95EE\u9898(Node.js\u65E0\u6CD5\u89E3\u6790\u6837\u5F0Fcss)</li><li>\u65B9\u6848\u4E00: \u670D\u52A1\u7AEF\u6253\u5305\u901A\u8FC7ignore-loader\u5FFD\u7565\u6389css\u7684\u89E3\u6790</li><li>\u65B9\u6848\u4E8C: \u5C06style-loader\u66FF\u6362\u6210isomorphic-style-loader</li></ul><p>\u5982\u4F55\u89E3\u51B3\u6837\u5F0F\u4E0D\u663E\u793A\u7684\u95EE\u9898?</p><p>\u4F7F\u7528\u6253\u5305\u51FA\u6765\u7684\u6D4F\u89C8\u5668\u7AEFHTML\u4E3A\u6A21\u677F</p><p>\u8BBE\u7F6E\u5360\u4F4D\u7B26,\u52A8\u6001\u63D2\u5165\u7EC4\u4EF6 <code>&lt;!--HTML_PLACEHOLDER--&gt;</code></p><p>\u9996\u5C4F\u6570\u636E\u5982\u4F55\u5904\u7406 \u670D\u52A1\u7AEF\u83B7\u53D6\u6570\u636E \u66FF\u6362\u5360\u4F4D\u7B26</p><p>\u5F53\u524D\u6784\u5EFA\u65F6\u7684\u65E5\u5FD7\u663E\u793A \u5C55\u793A\u4E00\u5927\u5806\u65E5\u5FD7,\u5F88\u591A\u5E76\u4E0D\u662F\u5F00\u53D1\u8005\u5173\u6CE8 \u7EDF\u8BA1\u4FE1\u606F stats</p><table><thead><tr><th>preset</th><th>alternative</th><th>description</th></tr></thead><tbody><tr><td>errors-only</td><td>none</td><td>\u53EA\u5728\u53D1\u751F\u9519\u8BEF\u65F6\u8F93\u51FA</td></tr><tr><td>minimal</td><td>none</td><td>\u53EA\u5728\u53D1\u751F\u9519\u8BEF\u6216\u6709\u65B0\u7684\u7F16\u8BD1\u65F6\u8F93\u51FA</td></tr><tr><td>none</td><td>false</td><td>\u6CA1\u6709\u8F93\u51FA</td></tr><tr><td>normal</td><td>true</td><td>\u6807\u51C6\u8F93\u51FA</td></tr><tr><td>verbose</td><td>none</td><td>\u5168\u90E8\u8F93\u51FA</td></tr></tbody></table><p>\u5982\u4F55\u4F18\u5316\u547D\u4EE4\u884C\u7684\u6784\u5EFA\u65E5\u5FD7 \u4F7F\u7528 friendly-errors-webpack-plugin</p><ul><li>success \u6784\u5EFA\u6210\u529F\u7684\u65E5\u5FD7\u63D0\u793A</li><li>warning \u6784\u5EFA\u8B66\u544A\u65F6\u7684\u65E5\u5FD7\u63D0\u793A</li><li>error \u6784\u5EFA\u62A5\u9519\u65F6\u7684\u65E5\u5FD7\u63D0\u793A</li></ul><p>stats \u8BBE\u7F6E\u6210erros-only</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> plugins<span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> stats<span class="token operator">=</span><span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5982\u4F55\u5224\u65AD\u6784\u5EFA\u662F\u5426\u6210\u529F? \u5728CI/CD \u7684 pipeline \u6216\u8005\u53D1\u5E03\u7CFB\u7EDF\u9700\u8981\u77E5\u9053\u5F53\u524D\u6784\u5EFA\u72B6\u6001</p><p>\u6BCF\u6B21\u6784\u5EFA\u5B8C\u6210\u540E\u8F93\u5165 <code>echo $?</code> \u83B7\u53D6\u9519\u8BEF\u7801</p><p>\u6784\u5EFA\u5F02\u5E38\u548C\u4E2D\u65AD\u5904\u7406 webpack4\u4E4B\u524D\u7684\u7248\u672C\u6784\u5EFA\u5931\u8D25\u4E0D\u4F1A\u629B\u51FA\u9519\u8BEF\u7801(error code) Node.js \u4E2D\u7684 prcess.exit \u89C4\u8303</p><ul><li>0 \u8868\u793A\u6210\u529F\u5B8C\u6210,\u56DE\u8C03\u51FD\u6570\u4E2D,err \u4E3Anull</li><li>\u975E0 \u8868\u793A\u6267\u884C\u5931\u8D25,\u56DE\u8C03\u51FD\u6570\u4E2D,error\u4E0D\u4E3Anull,error.code \u5C31\u662F\u4F20\u7ED9exit\u7684\u6570\u5B57</li></ul><p>\u5982\u4F55\u4E3B\u52A8\u6355\u83B7\u5E76\u5904\u7406\u6784\u5EFA\u9519\u8BEF? compiler\u5728\u6BCF\u6B21\u6784\u5EFA\u7ED3\u675F\u540E\u51FA\u53D1 done\u8FD9\u4E2A hook</p><p>process.exit \u4E3B\u52A8\u5904\u7406\u6784\u5EFA\u62A5\u9519</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hook<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;done&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>erros <span class="token operator">&amp;&amp;</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>erros<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;--watch&#39;</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;build error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_04-\u7F16\u5199\u53EF\u7EF4\u62A4\u7684webpack\u6784\u5EFA\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_04-\u7F16\u5199\u53EF\u7EF4\u62A4\u7684webpack\u6784\u5EFA\u914D\u7F6E" aria-hidden="true">#</a> 04 \u7F16\u5199\u53EF\u7EF4\u62A4\u7684webpack\u6784\u5EFA\u914D\u7F6E</h3><p>\u6784\u5EFA\u914D\u7F6E\u62BD\u79BB\u6210npm\u5305\u7684\u610F\u4E49</p><p>\u901A\u7528\u6027</p><ul><li>\u4E1A\u52A1\u5F00\u53D1\u8005\u65E0\u9700\u5173\u6CE8\u6784\u5EFA\u914D\u7F6E</li><li>\u7EDF\u4E00\u56E2\u961F\u6784\u5EFA\u811A\u672C</li></ul><p>\u53EF\u7EF4\u62A4\u6027</p><ul><li>\u6784\u5EFA\u914D\u7F6E\u5408\u7406\u7684\u62C6\u5206</li><li>README\u6587\u6863\u3001ChangeLog\u6587\u6863</li></ul><p>\u8D28\u91CF</p><ul><li>\u5192\u70DF\u6D4B\u8BD5\u3001\u5355\u5143\u6D4B\u8BD5\u3001\u6D4B\u8BD5\u8986\u76D6\u7387</li><li>\u6301\u7EED\u96C6\u6210</li></ul><p>\u6784\u5EFA\u914D\u7F6E\u7BA1\u7406\u7684 \u53EF\u9009\u65B9\u6848</p><ul><li>\u901A\u8FC7\u591A\u4E2A\u914D\u7F6E\u6587\u4EF6\u7BA1\u7406\u4E0D\u540C\u73AF\u5883\u7684\u6784\u5EFA\uFF0C webpack --config\u53C2\u6570\u8FDB\u884C\u63A7\u5236</li><li>\u5C06\u6784\u5EFA\u914D\u7F6E\u8BBE\u8BA1\u6210\u4E00\u4E2A\u5E93\uFF0C\u6BD4\u5982hjs-webpack\uFF0CNeutino\uFF0Cwebpack-blocks</li><li>\u62BD\u6210\u4E00\u4E2A\u5DE5\u5177\u8FDB\u884C\u7BA1\u7406\uFF0C\u6BD4\u5982create-react-app\uFF0Ckyt\uFF0Cnwb</li><li>\u5C06\u6240\u6709\u914D\u7F6E\u653E\u5728\u4E00\u4E2A\u6587\u4EF6\uFF0C\u901A\u8FC7 --env \u53C2\u6570\u63A7\u5236\u5206\u652F\u9009\u62E9</li></ul><p>\u6784\u5EFA\u914D\u7F6E\u5305\u8BBE\u8BA1 \u901A\u8FC7\u591A\u4E2A\u914D\u7F6E\u6587\u4EF6\u7BA1\u7406\u4E0D\u540C\u73AF\u5883\u7684webpack\u914D\u7F6E</p><ul><li>\u57FA\u7840\u914D\u7F6E webpack.base.js</li><li>\u5F00\u53D1\u73AF\u5883 dev</li><li>\u751F\u4EA7\u73AF\u5883 prod</li><li>ssr\u73AF\u5883 ssr</li></ul><p>\u62BD\u79BB\u6210\u4E00\u4E2Anpm\u5305\u7EDF\u4E00\u7BA1\u7406</p><ul><li>\u89C4\u8303\uFF1A git commit\u65E5\u5FD7\uFF0Creadme\uFF0Ceslint\u89C4\u8303\uFF0Csemver\u89C4\u8303</li><li>\u8D28\u91CF\uFF1A \u5192\u70DF\u6D4B\u8BD5\uFF0C\u5355\u5143\u6D4B\u8BD5\uFF0C\u6D4B\u8BD5\u8986\u76D6\u65C5\u548CCI</li></ul><p>\u901A\u8FC7webpack-merge \u7EC4\u5408\u914D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-merge&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">merge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span>devConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u529F\u80FD\u6A21\u5757\u8BBE\u8BA1</p><ul><li>\u57FA\u7840\u914D\u7F6E\uFF1Abase <ul><li>\u8D44\u6E90\u89E3\u6790:ES6,React,CSS,Less,\u56FE\u7247,\u5B57\u4F53</li><li>\u6837\u5F0F\u589E\u5F3A:CSS\u524D\u7F00\u8865\u9F50\uFF0CCSS px\u8F6C\u6362\u6210rem</li><li>\u76EE\u5F55\u6E05\u7406</li><li>\u591A\u9875\u9762\u6253\u5305</li><li>\u547D\u4EE4\u884C\u4FE1\u606F\u663E\u793A\u4F18\u5316</li><li>\u9519\u8BEF\u6355\u83B7\u548C\u5904\u7406</li><li>CSS\u63D0\u53D6\u6210\u4E00\u4E2A\u5355\u72EC\u7684\u6587\u4EF6</li></ul></li><li>\u5F00\u53D1\u9636\u6BB5\u914D\u7F6E\uFF1A <ul><li>\u4EE3\u7801\u70ED\u66F4\u65B0\uFF1ACSS\u70ED\u66F4\u65B0\uFF0CJS\u70ED\u66F4\u65B0</li><li>sourcemap</li></ul></li><li>\u751F\u4EA7\u9636\u6BB5\u914D\u7F6E\uFF1A <ul><li>\u4EE3\u7801\u538B\u7F29</li><li>\u6587\u4EF6\u6307\u7EB9</li><li>Tree Shaking</li><li>Scope Hoisting</li><li>\u901F\u5EA6\u4F18\u5316\uFF1A \u57FA\u7840\u5305CDN</li><li>\u4F53\u79EF\u4F18\u5316\uFF1A \u4EE3\u7801\u5206\u5272</li></ul></li><li>SSR\u914D\u7F6E\uFF1A <ul><li>output\u7684libraryTarget\u8BBE\u7F6E</li><li>CSS\u89E3\u6790\u7684ignore</li></ul></li></ul><p>\u76EE\u5F55\u7ED3\u6784\u8BBE\u8BA1 lib \u653E\u7F6E\u6E90\u4EE3\u7801 test \u653E\u7F6E\u6D4B\u8BD5\u4EE3\u7801 \u4F7F\u7528eslint\u89C4\u8303\u6784\u5EFA\u811A\u672C \u4F7F\u7528 eslint-config-airbnb-base eslint --fix \u53EF\u4EE5\u81EA\u52A8\u5904\u7406\u7A7A\u683C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-eslint&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint-config-airbnb-base&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;env&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token string-property property">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5192\u70DF\u6D4B\u8BD5 smoke testing \u5192\u70DF\u6D4B\u8BD5\u662F\u6307\u5BF9\u63D0\u4EA4\u6D4B\u8BD5\u7684\u8F6F\u4EF6\u5728\u8FDB\u884C\u8BE6\u7EC6\u6DF1\u5165\u7684\u6D4B\u8BD5\u4E4B\u524D\u800C\u8FDB\u884C\u7684\u9884\u6D4B\u8BD5\uFF0C \u8FD9\u79CD\u9884\u6D4B\u8BD5\u7684\u4E3B\u8981\u76EE\u7684\u662F\u66B4\u9732\u5BFC\u81F4\u8F6F\u4EF6\u9700\u91CD\u65B0\u53D1\u5E03\u7684\u57FA\u672C\u529F\u80FD\u5931\u6548\u7B49\u4E25\u91CD\u95EE\u9898</p><p>\u5192\u70DF\u6D4B\u8BD5\u6267\u884C \u6784\u5EFA\u662F\u5426\u6210\u529F \u6BCF\u6B21\u6784\u5EFA\u5B8C\u6210build\u76EE\u5F55\u662F\u5426\u6709\u5185\u5BB9\u8F93\u51FA</p><ul><li>\u662F\u5426\u6709JS\u3001CSS\u7B49\u9759\u6001\u8D44\u6E90\u6587\u4EF6</li><li>\u662F\u5426\u6709HTML\u6587\u4EF6</li></ul><p>\u5224\u65AD\u662F\u5426\u6784\u5EFA\u6210\u529F \u5728\u793A\u4F8B\u9879\u76EE\u91CC\u9762\u8FD0\u884C\u6784\u5EFA\uFF0C\u770B\u770B\u662F\u5426\u6709\u62A5\u9519</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rimraf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;rimraf&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Mocha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mocha&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mocha <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mocha</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token string">&#39;10000ms&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">rimraf</span><span class="token punctuation">(</span><span class="token string">&#39;./dist&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> prodConfig<span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../../lib/webpack.prod&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">webpack</span><span class="token punctuation">(</span>prodConfig<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>stats</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">colors</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token literal-property property">chunkMoudles</span><span class="token operator">:</span><span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token operator">+</span><span class="token string">&#39;Complier success, begin mocha test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u5224\u65AD\u57FA\u672C\u529F\u80FD\u662F\u5426\u6B63\u5E38 \u7F16\u5199mocha\u6D4B\u8BD5\u7528\u4F8B \u662F\u5426\u6709JS\uFF0CCSS\u9759\u6001\u8D44\u6E90\uFF0CHTML\u6587\u4EF6;</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> glob <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;glob-all&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;checking generated file exists&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should generate html files&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> files<span class="token operator">=</span>glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./dist/index.html&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;./dist/search.html&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;No html files found&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should generate js &amp; css files&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> files<span class="token operator">=</span>glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./dist/index_*.js&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;./dist/index_*.css&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>files<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;No files found&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u5355\u5143\u6D4B\u8BD5\u4E0E\u6D4B\u8BD5\u8986\u76D6\u7387 \u5355\u7EAF\u6D4B\u8BD5\u6846\u67B6\uFF0C\u9700\u8981\u65AD\u8A00\u5E93</p><ul><li>chai</li><li>should.js</li><li>expect</li><li>better-assert</li></ul><p>\u96C6\u6210\u6846\u67B6 \u5F00\u7BB1\u5373\u7528</p><ul><li>Jasmine</li><li>Jest</li></ul><p>\u6781\u7B80API</p><p>\u7F16\u5199\u5355\u5143\u6D4B\u8BD5\u7528\u4F8B</p><ul><li>\u6280\u672F\u9009\u578B: Mocha + Chai</li><li>\u6D4B\u8BD5\u4EE3\u7801: describe + it + expect</li><li>\u6D4B\u8BD5\u547D\u4EE4: mocha add.test.js</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;chai&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>
<span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../src/add&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;use expect: src/add.js&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;add(1,2)===3&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5355\u5143\u6D4B\u8BD5\u63A5\u5165</p><ol><li>\u5B89\u88C5 mocha + chai</li><li>\u65B0\u5EFAtest\u76EE\u5F55\uFF0C\u5E76\u589E\u52A0 [name].test.js\u6D4B\u8BD5\u6587\u4EF6</li><li>\u5728package.json\u4E2D scripts \u5B57\u6BB5\u589E\u52A0 test\u547D\u4EE4 <code>node_modules/mocha/bin/_mocha</code></li><li>\u6267\u884C\u6D4B\u8BD5\u547D\u4EE4 <code>npm run test</code></li></ol><p>\u6301\u7EED\u96C6\u6210\u7684\u4F5C\u7528 \u4F18\u70B9\uFF1A \u5FEB\u901F\u53D1\u73B0\u9519\u8BEF\uFF0C\u653E\u7F6E\u5206\u652F\u5927\u5E45\u504F\u79BB\u4E3B\u5E72</p><p>\u6838\u5FC3\u63AA\u65BD\u662F\uFF0C\u4EE3\u7801\u96C6\u6210\u5230\u4E3B\u5E72\u4E4B\u524D\uFF0C\u5FC5\u987B\u901A\u8FC7\u81EA\u52A8\u5316\u6D4B\u8BD5\u3002\u53EA\u8981\u6709\u4E00\u4E2A\u6D4B\u8BD5\u7528\u4F8B\u5931\u6548\u5C31\u4E0D\u80FD\u96C6\u6210\u3002</p><p>Github\u6700\u6D41\u884C\u7684CI \uFF08top10 Travis CI,Circle CI,Jenkins,AppVeyor,CodeShip,Drone,Semaphore CI,Buildkite,Wercker,TeamCity</p><p>\u63A5\u5165Travis CI</p><ol><li>https://travis-ci.org \u4F7F\u7528github\u8D26\u53F7\u767B\u5F55</li><li>\u5728/account/repositories \u4E3A\u9879\u76EE\u5F00\u542F</li><li>\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u65B0\u589E travis.yml</li></ol><p>yml\u6587\u4EF6\u5185\u5BB9 install\u5B89\u88C5\u9879\u76EE\u4F9D\u8D56 \uFF0Cscript\u8FD0\u884C\u6D4B\u8BD5\u7528\u4F8B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js

<span class="token key atrule">sudo</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">apt</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">directories</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> node_modules

<span class="token key atrule">node_js</span><span class="token punctuation">:</span> stable <span class="token comment"># \u8BBE\u7F6E\u76F8\u5E94\u7248\u672C</span>

<span class="token key atrule">install</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> npm install <span class="token punctuation">-</span>D <span class="token comment"># \u5B89\u88C5\u6784\u5EFA\u4F9D\u8D56\u5668</span>
    <span class="token punctuation">-</span> cd ./test/template<span class="token punctuation">-</span>project
    <span class="token punctuation">-</span> npm install <span class="token punctuation">-</span>D <span class="token comment"># \u5B89\u88C5\u6784\u5EFA\u4F9D\u8D56\u5668</span>

<span class="token key atrule">script</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> npm test
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u53D1\u5E03\u5230npm \u6DFB\u52A0\u7528\u6237 <code>npm adduser</code> \u5347\u7EA7\u7248\u672C</p><ul><li>\u5347\u7EA7\u8865\u4E01\u7248\u672C\u53F7 npm version patch</li><li>\u5347\u7EA7\u5C0F\u7248\u672C\u53F7 npm version minor</li><li>\u5347\u7EA7\u5927\u7248\u672C\u53F7 npm version major \u7248\u672C\u53D1\u5E03\uFF1A npm publish</li></ul><p>git\u89C4\u8303\u548Cchangelog\u751F\u6210 \u826F\u597D\u7684 git commit\u89C4\u8303\u4F18\u52BF\uFF1A</p><ul><li>\u52A0\u5FEBcode-review\u6D41\u7A0B</li><li>\u6839\u636Egit commit\u7684\u5143\u6570\u636E\u751F\u6210changelog</li><li>\u540E\u7EED\u7EF4\u62A4\u8005\u53EF\u4EE5\u77E5\u9053feature\u88AB\u4FEE\u6539\u7684\u539F\u56E0</li></ul><p>\u6280\u672F\u65B9\u6848, \u63D0\u4EA4\u683C\u5F0F- \u7EDF\u4E00\u56E2\u961Fcommit\u6807\u51C6 extends angular-gitcommit \u4F7F\u7528commitize\u5DE5\u5177\uFF0Cvalidate-commit-msg\u5DE5\u5177\uFF0Cgitlab serverhook\uFF0C \u4F7F\u7528conventional-changelog</p><p>\u63D0\u4EA4\u683C\u5F0F\u8981\u6C42</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
&lt;BLANK LINE&gt;
&lt;body&gt;
&lt;BLANK LINE&gt;
&lt;footer&gt;
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>type\u4EE3\u8868\u67D0\u6B21\u63D0\u4EA4\u7684\u7C7B\u578B</p><ul><li>feat \u65B0\u589Efeature</li><li>fix \u4FEE\u590Dbug</li><li>docs \u4EC5\u4EC5\u4FEE\u6539\u4E86\u6587\u6863\uFF0C\u6BD4\u5982README\uFF0CCHANGELOG\uFF0CCONTRIBUTE\u7B49\u7B49</li><li>style \u4EC5\u4EC5\u4FEE\u6539\u4E86\u7A7A\u683C\uFF0C\u683C\u5F0F\u7F29\u8FDB\uFF0C\u6807\u70B9\u7B26\u53F7\u7B49\uFF0C\u4E0D\u6539\u53D8\u4EE3\u7801\u903B\u8F91</li><li>refactor \u4EE3\u7801\u91CD\u6784\uFF0C\u6CA1\u6709\u52A0\u65B0\u7684\u529F\u80FD\u6216\u8005\u4FEE\u590Dbug</li><li>perf \u4F18\u5316\u76F8\u5173\uFF0C\u6BD4\u5982\u63D0\u5347\u6027\u80FD\u3001\u4F53\u9A8C</li><li>test \u6D4B\u8BD5\u7528\u4F8B \u5305\u62EC\u5355\u5143\u6D4B\u8BD5 \u96C6\u6210\u6D4B\u8BD5\u7B49</li><li>chore \u6539\u53D8\u6784\u5EFA\u6D41\u7A0B\u3001\u6216\u8005\u589E\u52A0\u4F9D\u8D56\u5E93 \u5DE5\u5177\u7B49</li><li>rever \u540CGIT\u56DE\u6EDA</li></ul><p>\u672C\u5730\u5F00\u53D1\u9636\u6BB5\u589E\u52A0preCommit\u94A9\u5B50 \u5B89\u88C5husky \u901A\u8FC7commitmsg\u94A9\u5B50\u6821\u9A8C\u4FE1\u606F</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;commitmsg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validate-commit-msg&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s -r 0&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token property">&quot;validate-commit-msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;^2.11&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;conventional-changelog-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.13&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u5F00\u6E90\u9879\u76EE\u7248\u672C\u4FE1\u606F\u6848\u4F8B</p><ul><li>\u8F6F\u4EF6\u7684\u7248\u672C\u901A\u5E38\u7531\u4E09\u4F4D\u7EC4\u6210\uFF0C\u5F62\u5982X.Y.Z</li><li>\u7248\u672C\u662F\u4E25\u683C\u9012\u589E\u7684</li><li>\u5728\u53D1\u5E03\u91CD\u8981\u7248\u672C\u65F6\uFF0C\u53EF\u4EE5\u53D1\u5E03alpha,rc\u7B49\u5148\u884C\u7248\u672C</li><li>aplha\uFF0Crc\u7B49\u4FEE\u9970\u7248\u672C\u7684\u5173\u952E\u5B57\u540E\u9762\u53EF\u4EE5\u5E26\u4E0A\u6B21\u6570\u548Cmeta\u4FE1\u606F</li></ul><p>\u9075\u5B88semsemver \u89C4\u8303\u7684\u4F18\u52BF \u907F\u514D\u51FA\u73B0\u5FAA\u73AF\u4F9D\u8D56 \u4F9D\u8D56\u51B2\u7A81\u51CF\u5C11</p><p>\u8BED\u4E49\u5316\u7248\u672C(Semantic Versioning)\u89C4\u8303\u683C\u5F0F \u4E3B\u7248\u672C\u53F7\uFF1A \u5F53\u4F60\u505A\u4E86\u4E0D\u517C\u5BB9\u7684API\u4FEE\u6539 \u6B21\u7248\u672C\u53F7\uFF1A \u5F53\u4F60\u505A\u4E86\u5411\u4E0B\u517C\u5BB9\u7684\u529F\u80FD\u65B0\u589E \u4FEE\u8BA2\u53F7: \u5F53\u4F60\u505A\u4E86\u5411\u4E0B\u517C\u5BB9\u7684\u95EE\u9898\u4FEE\u6B63</p><p>\u5148\u884C\u7248\u672C\u53F7</p><p>\u5148\u884C\u7248\u672C\u53F7\u53EF\u4EE5\u4F5C\u4E3A\u53D1\u5E03\u6B63\u5F0F\u7248\u4E4B\u524D\u7684\u7248\u672C\uFF0C\u683C\u5F0F\u662F\u5728\u4FEE\u8BA2\u7248\u672C\u53F7\u540E\u9762\u52A0\u4E0A\u4E00\u4E2A\u8FDE\u63A5\u53F7(-), \u518D\u52A0\u4E0A\u4E00\u8FDE\u4E32\u4EE5\u70B9(.)\u5206\u5272\u7684\u6807\u8BC6\u7B26\uFF0C\u6807\u8BC6\u7B26\u53EF\u4EE5\u7531\u82F1\u6587\u6570\u5B57\u548C\u8FDE\u63A5\u53F7[0-9A-Za-z-]\u7EC4\u6210</p><ul><li>alpha \u662F\u5185\u90E8\u6D4B\u8BD5\u7248\uFF0C\u4E00\u822C\u4E0D\u5411\u5916\u53D1\u5E03\uFF0C\u4F1A\u6709\u5F88\u591Abug\uFF0C\u4E00\u822C\u53EA\u6709\u6D4B\u8BD5\u4EBA\u5458\u4F7F\u7528\u3002</li><li>beta \u4E5F\u662F\u6D4B\u8BD5\u7248\uFF0C\u8FD9\u4E2A\u9636\u6BB5\u7684\u7248\u672C\u4E0D\u4F1A\u4E00\u76F4\u52A0\u5165\u65B0\u7684\u529F\u80FD\uFF0C\u5728Alpha\u7248\u672C\u4E4B\u540E\u63A8\u51FA</li><li>rc Release Candidate \u7CFB\u7EDF\u5E73\u53F0\u4E0A\u5C31\u662F\u53D1\u884C\u5019\u9009\u7248\u672C\u3002RC\u7248\u672C\u4E0D\u4F1A\u518D\u52A0\u5165\u65B0\u7684\u529F\u80FD\u4E86\uFF0C\u4E3B\u8981\u7740\u91CD\u4E8E\u9664\u9519</li></ul><h3 id="_05-webpack\u6784\u5EFA\u901F\u5EA6\u548C\u4F53\u79EF\u4F18\u5316\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_05-webpack\u6784\u5EFA\u901F\u5EA6\u548C\u4F53\u79EF\u4F18\u5316\u7B56\u7565" aria-hidden="true">#</a> 05 Webpack\u6784\u5EFA\u901F\u5EA6\u548C\u4F53\u79EF\u4F18\u5316\u7B56\u7565</h3><p>\u521D\u7EA7\u5206\u6790\uFF1A\u4F7F\u7528webpack\u5185\u7F6E\u7684stats</p><p>stats\uFF1A\u6784\u5EFA\u7684\u7EDF\u8BA1\u4FE1\u606F package.json \u4E2D\u4F7F\u7528 stats <code>&quot;build:stats&quot;:&quot;webpack --env production --json &gt; stats.json&quot;</code>,</p><p>Node.js \u4F7F\u7528</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack.config.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>stats</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&#39;errors-only&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>** \u9897\u7C92\u5EA6\u592A\u7C97\uFF0C\u770B\u4E0D\u51FA\u95EE\u9898\u6240\u5728</p><p>\u901F\u5EA6\u5206\u6790\uFF1A \u4F7F\u7528speed-measure-webpack-plugin \u4EE3\u7801\u793A\u4F8B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> SpeedMeasurePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;speed-measure-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">MyOtherPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\u6BCF\u4E2Aloader\u548C\u63D2\u4EF6\u6267\u884C\u8017\u65F6</p><p>\u901F\u5EA6\u5206\u6790\u63D2\u4EF6\u4F5C\u7528 \u5206\u6790\u6574\u4E2A\u6253\u5305\u603B\u8017\u65F6 \u6BCF\u4E2A\u63D2\u4EF6\u548Cloader\u7684\u8017\u65F6\u60C5\u51B5</p><p>webpack-bundle-analyzer \u5206\u6790\u4F53\u79EF \u4EE3\u7801\u793A\u4F8B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> BunldeAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-bundle-analyzer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6784\u5EFA\u5B8C\u6210\u540E\u4F1A\u57288888\u7AEF\u53E3\u5C55\u793A\u5927\u5C0F \u53EF\u4EE5\u5206\u6790\u54EA\u4E9B\u95EE\u9898</p><ul><li>\u4F9D\u8D56\u7684\u7B2C\u4E09\u65B9\u6A21\u5757\u6587\u4EF6\u5927\u5C0F</li><li>\u4E1A\u52A1\u91CC\u9762\u7684\u7EC4\u4EF6\u4EE3\u7801\u5927\u5C0F</li></ul><p>\u4F7F\u7528\u9AD8\u7248\u672C\u7684webpack\u548CNode.js \u6784\u5EFA\u65F6\u95F4\u964D\u4F4E\u4E8660%-98%\uFF1B</p><p>\u4F7F\u7528webpack4 \u4F18\u5316\u539F\u56E0</p><ul><li>V8\u5E26\u6765\u7684\u4F18\u5316\uFF08for of\u66FF\u4EE3forEach Map Set\u66FF\u4EE3Object includes\u66FF\u4EE3indexOf\uFF09</li><li>\u9ED8\u8BA4\u4F7F\u7528\u66F4\u5FEB\u7684md4 hash\u7B97\u6CD5</li><li>webpack AST\u53EF\u4EE5\u76F4\u63A5\u4ECEloader\u4F20\u9012\u7ED9AST\uFF0C\u51CF\u5C11\u89E3\u6790\u65F6\u95F4</li><li>\u4F7F\u7528\u5B57\u7B26\u4E32\u65B9\u6CD5\u66FF\u4EE3\u6B63\u5219\u8868\u8FBE\u5F0F</li></ul><p>\u591A\u8FDB\u7A0B/\u591A\u5B9E\u4F8B\u6784\u5EFA\uFF1A\u8D44\u6E90\u5E76\u884C\u89E3\u6790\u53EF\u9009\u65B9\u6848 thread-loader \u53EF\u9009\u65B9\u6848 parallel-webpack HappyPack \u591A\u8FDB\u7A0B/\u591A\u5B9E\u4F8B\uFF1A\u4F7F\u7528HappyPack\u89E3\u6790\u8D44\u6E90 \u539F\u7406\uFF1A\u6BCF\u6B21webpack \u89E3\u6790\u4E00\u4E2A\u6A21\u5757\uFF0CHappyPack\u4F1A\u5C06\u5B83\u53CA\u5B83\u7684\u4F9D\u8D56\u5206\u914D\u7ED9worker\u7EBF\u7A0B\u4E2D \u4EE3\u7801\u793A\u4F8B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span>plugins<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;jsx&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">threads</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token literal-property property">loaders</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;styles&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">threads</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u591A\u8FDB\u7A0B/\u591A\u5B9E\u4F8B\uFF1A\u4F7F\u7528thread-loader\u89E3\u6790\u8D44\u6E90 \u539F\u7406\uFF1A\u6BCF\u6B21webpack\u89E3\u6790\u4E00\u4E2A\u6A21\u5757 thread-loader\u4F1A\u5C06\u5B83\u53CA\u5B83\u7684\u4F9D\u8D56\u5206\u914D\u7ED9worker\u7EBF\u7A0B\u4E2D</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> json<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;module.rules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;thread-loader&#39;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">workers</span><span class="token operator">:</span> <span class="token number">3</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
                <span class="token comment">// &#39;eslint-loader&#39;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u591A\u8FDB\u7A0B/\u591A\u5B9E\u4F8B\uFF1A\u5E76\u884C\u538B\u7F29 \u65B9\u6CD5\u4E00\uFF1A\u4F7F\u7528parallel-uglify-plugin\u63D2\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ParallelUglifyPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-parallel-uglify-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">uglifyJS</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">beautify</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">compress</span><span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">collapse_vars</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">reduce_vars</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u5E76\u884C\u538B\u7F29 \u65B9\u6CD5\u4E8C\uFF1Auglifyjs-webpack-plugin \u5F00\u542Fparallel\u53C2\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> UglifyJsPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;uglifyjs-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">uglifyOptions</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">parse</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">mangle</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                <span class="token literal-property property">toplevel</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">nameCache</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                <span class="token literal-property property">ie8</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">keep_fnames</span><span class="token operator">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u5E76\u884C\u538B\u7F29 \u65B9\u6CD5\u4E09\uFF1Aterser-webpack-plugin \u5F00\u542F parallel\u53C2\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> TerserPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;terser-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">minimizer</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token number">4</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5206\u5305\uFF1A\u8BBE\u7F6EExternals \u601D\u8DEF\uFF1A\u5C06 react\u3001react-dom\u57FA\u7840\u5305 \u901A\u8FC7cdn\u5F15\u5165\uFF0C\u4E0D\u6253\u5165bundle\u4E2D \u65B9\u6CD5: \u4F7F\u7528html-webpack-externals-plugin</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">externals</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//11.url.cn/now/lib/15.1.0/react-with-addons.min.js?v=1&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token string">&#39;React&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&#39;react-dom&#39;</span>
            <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&#39;//11.url.cn/now/lib/15.1.0/react-dom.min.js?v=1&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token string">&#39;ReactDom&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u8FDB\u4E00\u6B65\u8BBE\u7F6E\u5206\u5305\uFF1A\u9884\u7F16\u8BD1\u8D44\u6E90\u6A21\u5757 \u601D\u8DEF\uFF1A \u5C06react\u3001react-dom\u3001redux\u3001react-redux\u57FA\u7840\u5305\u548C\u4E1A\u52A1\u57FA\u7840\u5305\u6253\u6210\u4E00\u4E2A\u6587\u4EF6 \u65B9\u6CD5\uFF1A\u4F7F\u7528DLLPlugin \u8FDB\u884C\u5206\u5305\uFF0CDllReferencePlugin \u5BF9manifest.json\u5F15\u7528</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;.jsx&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;.json&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;.less&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;.css&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">[</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;react-dom&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;redux&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].dll.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;./build/library&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&#39;[name]&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;[name]&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;./build/library/[name].json&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u5728webpack.config.js\u5F15\u5165</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">manifest</span><span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./build/library/manifest.json&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5F15\u7528\u6548\u679C <code>&lt;script src=&quot;/build/library/library.dll.js&quot;&gt;&lt;/script&gt;</code></p><p>\u7F13\u5B58 \u76EE\u7684\uFF1A\u63D0\u5347\u4E8C\u6B21\u6784\u5EFA\u901F\u5EA6 \u7F13\u5B58\u601D\u8DEF\uFF1A babel-loader \u5F00\u542F\u7F13\u5B58 terser-webpack-plugin \u5F00\u542F\u7F13\u5B58 \u4F7F\u7528cache-loader\u6216\u8005 hard-source-webpack-plugin</p><p>\u7F29\u5C0F\u6784\u5EFA\u76EE\u6807 \u76EE\u7684:\u5C3D\u53EF\u80FD\u7684\u5C11\u6784\u5EFA\u6A21\u5757 \u6BD4\u5982babel-loader\u4E0D\u89E3\u6790node_modules <code>loader:&#39;happypack/loader&#39;,exclude:&#39;node_modules&#39;</code></p><p>\u51CF\u5C11\u6587\u4EF6\u641C\u7D22\u8303\u56F4 \u4F18\u5316 resolve.modules\u8BBE\u7F6E\uFF08\u51CF\u5C11\u6A21\u5757\u641C\u7D22\u5C42\u7EA7\uFF09 \u4F18\u5316resolve.mainFields \u914D\u7F6E \u4F18\u5316 resolve.extensions \u914D\u7F6E \u5408\u7406\u4F7F\u7528alias</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">react</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;./node_modules/react/dist/react.min.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mainFields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;main&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u56FE\u7247\u538B\u7F29 \u8981\u6C42\uFF1A\u57FA\u4E8ENode\u5E93\u7684imagemin\u6216\u8005tinypng API \u4F7F\u7528\uFF1A\u914D\u7F6Eimage-webpack-loader</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|svg|jpg|gif|blob)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">img/[name]</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.[ext]</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;image-webpack-loader&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">mozjpeg</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">progresive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">65</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">optipng</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pngquant</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">quality</span><span class="token operator">:</span><span class="token string">&#39;65-90&#39;</span><span class="token punctuation">,</span><span class="token literal-property property">speed</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">gifsicle</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">interlaced</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">webp</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">quality</span><span class="token operator">:</span><span class="token number">75</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Imagemin\u4F18\u70B9\u5206\u6790 \u6709\u5F88\u591A\u5B9A\u5236\u9009\u9879 \u53EF\u4EE5\u5F15\u5165\u66F4\u591A\u7B2C\u4E09\u65B9\u4F18\u5316\u63D2\u4EF6 \u4F8B\u5982pngquant \u53EF\u4EE5\u5904\u7406\u591A\u79CD\u56FE\u7247\u683C\u5F0F \u538B\u7F29\u539F\u7406</p><ul><li>pngquant: \u662F\u4E00\u6B3Epng\u538B\u7F29\u5668\uFF0C\u901A\u8FC7\u5C06\u56FE\u50CF\u8F6C\u4E3A\u5177\u6709alpha\u901A\u9053\u7684\u66F4\u9AD8\u6548\u76848\u4E3APNG\u683C\u5F0F\uFF0C\u53EF\u663E\u8457\u51CF\u5C11\u6587\u4EF6\u5927\u5C0F</li><li>pngcrush\uFF1A \u5176\u4E3B\u8981\u76EE\u7684\u662F\u901A\u5E38\u5C1D\u8BD5\u4E0D\u540C\u7684\u538B\u7F29\u7EA7\u522B\u548CPNG\u8FC7\u6EE4\u65B9\u6CD5\u6765\u964D\u4F4EPNG IDAT\u6570\u636E\u6D41\u7684\u5927\u5C0F</li><li>optipng: \u5176\u8BBE\u8BA1\u7075\u611F\u6765\u81EA\u4E8Epngcrush\u3002optipng\u53EF\u5C06\u56FE\u50CF\u6587\u4EF6\u91CD\u65B0\u538B\u7F29\u4E3A\u66F4\u5C0F\u5C3A\u5BF8\uFF0C\u800C\u4E0D\u662F\u4F1A\u4E22\u5931\u4EFB\u4F55\u4FE1\u606F</li><li>tinypng\uFF1A\u4E5F\u662F\u5C0624\u4F4Dpng\u6587\u4EF6\u8F6C\u5316\u4E3A\u66F4\u5C0F\u6709\u7D22\u5F15\u76848\u4F4D\u56FE\u7247\uFF0C\u540C\u65F6\u6240\u6709\u975E\u5FC5\u8981\u7684metadata\u4E5F\u4F1A\u5265\u79BB\u6389</li></ul><h4 id="tree-shanking-\u590D\u4E60" tabindex="-1"><a class="header-anchor" href="#tree-shanking-\u590D\u4E60" aria-hidden="true">#</a> Tree Shanking\uFF08\u590D\u4E60</h4><p>\u6982\u5FF5\uFF1A 1\u4E2A\u6A21\u5757\u53EF\u80FD\u6709\u591A\u4E2A\u65B9\u6CD5\uFF0C\u53EA\u8981\u5176\u4E2D\u7684\u67D0\u4E2A\u65B9\u6CD5\u4F7F\u7528\u5230\u4E86\uFF0C\u5219\u6574\u4E2A\u6587\u4EF6\u90FD\u4F1A\u88AB\u6253\u5230 bundle \u91CC\u9762\u53BB\uFF0Ctressshaking\u5C31\u662F\u628A\u7528\u5230\u7684\u65B9\u6CD5\u6253\u5165bundle\uFF0C\u6CA1\u7528\u5230\u7684\u65B9\u6CD5\u4F1A\u5728uglify\u9636\u6BB5\u88AB\u64E6\u9664\u6389</p><p>\u4F7F\u7528webpack\u9ED8\u8BA4\u652F\u6301\uFF0C\u5728.babelrc\u91CC\u8BBE\u7F6Emodules: false \u5373\u53EF .production mode\u60C5\u51B5\u4E0B\u9ED8\u8BA4\u5F00\u542F \u8981\u6C42\uFF1A\u5FC5\u987B\u662FES6\u8BED\u6CD5\uFF0CCJS\u7684\u65B9\u5F0F\u4E0D\u652F\u6301</p><p>\u65E0\u7528\u7684CSS\u5982\u4F55\u5220\u9664\u6389 PurifyCSS\u4FBF\u5229\u4EE3\u7801\uFF0C\u8BC6\u522B\u5DF2\u7ECF\u7528\u5230\u7684CSS class uncss\uFF1A HTML\u9700\u8981\u901A\u8FC7jsdom\u52A0\u8F7D\uFF0C\u6240\u6709\u7684\u6837\u5F0F\u901A\u8FC7PostCSS\u89E3\u6790\uFF0C\u901A\u8FC7 document.querySelector\u6765\u8BC6\u522Bhtml\u6587\u4EF6\u91CC\u9762\u4E0D\u5B58\u5728\u7684\u9009\u62E9\u5668</p><p>\u5728webpack\u4E2D\u5982\u4F55\u4F7F\u7528PurifyCSS \u4F7F\u7528purgress-webpack-plugin \u548Cmini-css-extract-plugin\u914D\u5408\u4F7F\u7528 \u548Cmini-css-extract-plugin</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">&#39;[name].css&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">paths</span><span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">PATH</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">nodir</span><span class="token operator">:</span> <span class="token boolean">true</span>\`<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u6784\u5EFA\u4F53\u79EF\u4F18\u5316\u52A8\u6001polyfill babel-polyfill \u6253\u5305\u540E\u4F53\u79EF88.49K!!! Promise\u7684\u6D4F\u89C8\u5668\u652F\u6301\u60C5\u51B5</p><table><thead><tr><th>\u65B9\u6848</th><th>\u4F18\u70B9</th><th>\u7F3A\u70B9</th><th>\u662F\u5426\u91C7\u7528</th></tr></thead><tbody><tr><td>babel-polyfill</td><td>React\u5B98\u65B9\u63A8\u8350</td><td>\u5305\u4F53\u79EF\u5927</td><td>x</td></tr><tr><td>babel-plugin-transform-runtime</td><td>\u80FD\u53EApolyfill\u5230\u65B9\u6CD5</td><td>\u4E0D\u80FDpolyfill\u539F\u578B\u4E0A\u9B54\u6CD5</td><td>x</td></tr><tr><td>\u81EA\u5DF1map\uFF0Cset\u7684polyfill</td><td>\u5B9A\u5236\u5316\u9AD8</td><td>\u79EF\u5C0F\u5C0F</td><td>x</td></tr><tr><td>polyfill-service</td><td>\u53EA\u7ED9\u7528\u6237\u56DE\u9700\u8981\u7684polyfill\uFF0C\u793E\u533A\u7EF4\u62A4</td><td>\u90E8\u5206\u56FD\u5185UA\u6302</td><td>\u2611\uFE0F</td></tr></tbody></table><p>Polyfill Service \u539F\u7406 \u8BC6\u522BUserAgent \u4E0B\u53D1\u4E0D\u540C\u7684Polyfill</p><p>\u6784\u5EFA\u4F53\u79EF\u4F18\u5316\uFF1A\u5982\u4F55\u52A8\u6001PolyfillService polyfill.io \u5B98\u65B9\u63D0\u4F9B\u7684\u670D\u52A1 <code>&lt;script src=&quot;https://cdn.polyfill.io/v2/polyfill.min.js&quot;&gt;&lt;/script&gt;</code></p><p>\u57FA\u4E8E\u5B98\u65B9\u81EA\u5EFA\u7684polyfill\u670D\u52A1</p><p>\u4F53\u79EF\u4F18\u5316\u7B56\u7565\u603B\u7ED3</p><ul><li>Scope Hoisting</li><li>Tree Shaking</li><li>\u516C\u7528\u8D44\u6E90\u5206\u79BB</li><li>\u56FE\u7247\u538B\u7F29</li><li>\u52A8\u6001polyfill</li></ul><h3 id="_06-\u901A\u8FC7\u6E90\u7801\u638C\u63E1webpack\u6253\u5305\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_06-\u901A\u8FC7\u6E90\u7801\u638C\u63E1webpack\u6253\u5305\u539F\u7406" aria-hidden="true">#</a> 06 \u901A\u8FC7\u6E90\u7801\u638C\u63E1webpack\u6253\u5305\u539F\u7406</h3><p>\u5F00\u59CB\uFF1A \u4ECEwebpack\u547D\u4EE4\u884C\u8BF4\u8D77 \u901A\u8FC7npm scripts\u8FD0\u884C webpack</p><ul><li>\u5F00\u53D1\u73AF\u5883 npm run dev</li><li>\u751F\u4EA7\u73AF\u5883 npm run build</li></ul><p>\u901A\u8FC7webpack\u76F4\u63A5\u8FD0\u884C</p><ul><li>webpack entry.js bundle.js</li></ul><blockquote><p>\u8FD9\u4E2A\u8FC7\u7A0B\u53D1\u751F\u4E86\u4EC0\u4E48</p></blockquote><p>\u67E5\u627Ewebpack\u5165\u53E3\u6587\u4EF6 \u5728\u547D\u4EE4\u884C\u8FD0\u884C\u4EE5\u4E0A\u547D\u4EE4\u540E\uFF0Cnpm\u4F1A\u8BA9\u547D\u4EE4\u884C\u5DE5\u5177 \u8FDB\u5165<code>node_modules/.bin</code> \u76EE\u5F55\u67E5\u627E\u662F\u5426\u5B58\u5728webpack.sh\u6216\u8005webpack.cmd\u6587\u4EF6\uFF0C\u5982\u679C\u5B58\u5728\uFF0C\u5C31\u6267\u884C \u4E0D\u5B58\u5728\u5219\u629B\u51FA\u9519\u8BEF \u5B9E\u9645\u5165\u53E3\u6587\u4EF6\u662F: node_modules/webpack/in/webpack.js</p><p>\u5206\u6790webpack\u7684\u5165\u53E3\u6587\u4EF6: webpack.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">0</span>\uFF1B
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span>args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">isInstalled</span><span class="token operator">=</span><span class="token parameter">packagName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CLIs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token comment">// webpack-command</span>
<span class="token keyword">const</span> installcides<span class="token operator">=</span><span class="token constant">CLI</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">cli</span><span class="token operator">=&gt;</span>cli<span class="token punctuation">.</span>installed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length<span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span>
<span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length<span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u542F\u52A8\u540E\u7684\u7ED3\u679C webpack\u6700\u7EC8\u627E\u5230 webpack-cli(webpack-command)\u8FD9\u4E2A npm\u5305 \u5E76\u4E14\u6267\u884Ccli</p><p>webpack-cli\u505A\u7684\u4E8B\u60C5 \u5F15\u5165yargs\uFF0C\u5BF9\u547D\u4EE4\u8FDB\u884C\u5B9A\u5236 \u5206\u6790\u547D\u4EE4\u884C\u53C2\u6570\uFF0C\u5BF9\u5404\u4E2A\u53C2\u6570\u8FDB\u884C\u8F6C\u6362\uFF0C\u7EC4\u6210\u7F16\u8BD1\u914D\u7F6E\u9879 \u5F15\u7528webpack\uFF0C\u6839\u636E\u914D\u7F6E\u9879\u8FDB\u884C\u7F16\u8BD1\u548C\u6784\u5EFA</p><p>\u4ECENON_COMPILATION_CMD\u5206\u6790\u51FA\u4E0D\u9700\u8981\u7F16\u8BD1\u7684\u547D\u4EE4 webpck-cli \u5904\u7406\u4E0D\u9700\u8981\u7ECF\u8FC7\u7F16\u8BD1\u7684\u547D\u4EE4</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils/constants&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_CMD</span><span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>arg <span class="token operator">===</span> <span class="token string">&#39;serve&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        global<span class="token punctuation">.</span>precess<span class="token punctuation">.</span>argv<span class="token operator">=</span>global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token operator">=&gt;</span>a<span class="token operator">!==</span><span class="token string">&#39;serve&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span>argv<span class="token operator">=</span>global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token operator">=&gt;</span>a<span class="token operator">===</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils/prompt-command&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">,</span><span class="token operator">...</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>_ARGS \u7684\u5185\u5BB9 init // \u521B\u5EFA\u4E00\u4EFDwebpack\u914D\u7F6E\u6587\u4EF6 migrate // \u8FDB\u884Cwebpack\u7248\u672C\u8FC1\u79FB add // \u5F80webpack\u914D\u7F6E\u6587\u4EF6\u4E2D\u589E\u52A0\u5C5E\u6027 remove // \u5220\u9664\u5C5E\u6027 serve // \u8FD0\u884Cwebpack-serve generate-loader // \u751F\u6210loader\u4EE3\u7801<br> generate-plugin // \u751F\u6210plugin\u4EE3\u7801 info \u8FD4\u56DE\u4E0E\u672C\u5730\u73AF\u5883\u76F8\u5173\u7684\u4E00\u4E9B\u4FE1\u606F</p><p>\u547D\u4EE4\u884C\u5DE5\u5177\u5305yargs\u4ECB\u7ECD</p><p>\u52A8\u6001\u751F\u6210help \u5E2E\u52A9\u4FE1\u606F</p><p>webpack-cli\u4F7F\u7528args\u5206\u6790 \u53C2\u6570\u5206\u7EC4(config/config-args.js),\u5C06\u547D\u4EE4\u5212\u5206\u4E3A9\u7C7B</p><p>config options \u914D\u7F6E\u76F8\u5173\u7684\u53C2\u6570 \u6587\u4EF6\u540D\u79F0\uFF0C\u8FD0\u884C\u73AF\u5883\u7B49 basic options \u57FA\u7840\u53C2\u6570 entry\u8BBE\u7F6E\uFF0Cdebug\u6A21\u5F0F\uFF0Cwatch\uFF0Cdevtool\u8BBE\u7F6E\u7B49 module options \u6A21\u5757\u53C2\u6570\uFF0C\u7ED9loader \u8BBE\u7F6E\u6269\u5C55 output options \u8F93\u51FA\u53C2\u6570\uFF08\u8F93\u51FA\u8DEF\u5F84\uFF0C\u8F93\u51FA\u6587\u4EF6\u540D\u79F0 advacnded options \u9AD8\u7EA7\u7528\u6CD5\uFF0C\u8BB0\u5F55\u8BBE\u7F6E\uFF0C\u7F13\u5B58\u8BBE\u7F6E\uFF0C\u76D1\u542C\u9891\u7387\uFF0Cbail\u7B49 resloving options \u89E3\u6790\u53C2\u6570 alias\u548C\u89E3\u6790\u6587\u4EF6\u540E\u7F00 \u8BBE\u7F6E optmization options \u4F18\u5316\u53C2\u6570 status options \u7EDF\u8BA1\u53C2\u6570 options \u901A\u7528\u53C2\u6570 \u5E2E\u52A9\u547D\u4EE4 \u7248\u672C\u4FE1\u606F\u7B49</p><p>webpack-cli \u6267\u884C\u7ED3\u679C webpack-cli \u5BF9\u914D\u7F6E\u6587\u4EF6\u548C\u547D\u4EE4\u884C\u53C2\u6570\u8FDB\u884C\u8F6C\u6362\u6700\u7EC8\u751F\u6210\u914D\u7F6E\u9009\u9879\u53C2\u6570options \u6700\u7EC8\u4F1A\u6839\u636E\u914D\u7F6E\u53C2\u6570\u5B9E\u4F8B\u5316webpack\u5BF9\u8C61\uFF0C\u7136\u540E\u6267\u884C\u6784\u5EFA\u6D41\u7A0B webpack\u672C\u8D28 webpack\u53EF\u4EE5\u5C06\u5176\u7406\u89E3\u662F\u4E00\u79CD\u57FA\u4E8E\u4E8B\u4EF6\u6D41\u7684\u7F16\u7A0B\u89C4\u8303\uFF0C\u4E00\u7CFB\u5217\u7684\u63D2\u4EF6\u8FD0\u884C \u5148\u770B\u4E00\u6BB5\u4EE3\u7801 \u6838\u5FC3\u5BF9\u8C61Compiler\u7EE7\u627FTapable class Compiler extends Tapable{ // } \u6838\u5FC3\u5BF9\u8C61Compilation\u96C6\u6210Tapable{ // } Tapable\u662F\u4EC0\u4E48\uFF1F Tapable\u662F\u4E00\u4E2A\u7C7B\u4F3C\u4E8ENode.js\u7684EventEmitter\u7684\u5E93,\u4E3B\u8981\u662F\u63A7\u5236\u94A9\u5B50\u7684\u53D1\u5E03\u4E0E\u8BA2\u9605\uFF0C\u63A7\u5236\u8FD9\u4E2Awebpack\u7684\u63D2\u4EF6\u7CFB\u7EDF Tapable\u5E93\u66B4\u9732\u4E86\u5F88\u591AHooks ...</p><h4 id="\u6A21\u62DFcompiler-js" tabindex="-1"><a class="header-anchor" href="#\u6A21\u62DFcompiler-js" aria-hidden="true">#</a> \u6A21\u62DFCompiler.js</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token keyword">class</span> <span class="token class-name">Compiler</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hoos<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token literal-property property">accelerate</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;newspped&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">brake</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">calculateRoutes</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;source&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;routesList&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">accerate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">break</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculateRoutes</span><span class="token punctuation">(</span><span class="token string">&#39;Async&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;hook&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">accelerate</span><span class="token punctuation">(</span><span class="token parameter">speed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">break</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">calculateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">lerror</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u63D2\u4EF6 my-plugins.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Compiler<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./Compiler&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>brake<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;WarningLampPlugin&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;WarningLampPlugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>accelerate<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;LoggerPlugin&#39;</span><span class="token punctuation">,</span><span class="token parameter">newSpeed</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Accelerating to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newSpeed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&#39;calculateRoutes tapAsync&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span>target<span class="token punctuation">,</span>routesList</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">tapPromise to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>routesList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>\u6A21\u62DF\u63D2\u4EF6\u6267\u884C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> myPlugin <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin<span class="token operator">===</span><span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="webppack-\u6D41\u7A0B\u7BC7" tabindex="-1"><a class="header-anchor" href="#webppack-\u6D41\u7A0B\u7BC7" aria-hidden="true">#</a> Webppack \u6D41\u7A0B\u7BC7</h4><p>webpack\u7684\u7F16\u8BD1\u90FD\u6309\u7167\u4E0B\u9762\u7684\u94A9\u5B50\u8C03\u7528\u987A\u5E8F\u6267\u884C *entry-option -&gt; *run -&gt; *make -&gt; *before-resolve -&gt; *build-module -&gt; *normal-module-loader -&gt; *program -&gt; *seal -&gt; *emit</p><ol><li>\u521D\u59CB\u5316 option</li><li>\u5F00\u59CB\u7F16\u8BD1</li><li>\u4ECEentry\u5F00\u59CB\u9012\u5F52\u7684\u5206\u6790\u4F9D\u8D56\uFF0C\u5BF9\u6BCF\u4E2A\u4F9D\u8D56\u6A21\u5757\u8FDB\u884Cbuild</li><li>\u5BF9\u6A21\u5757\u4F4D\u7F6E\u8FDB\u884C\u89E3\u6790</li><li>\u5F00\u59CB\u6784\u5EFA\u67D0\u4E2A\u6A21\u5757</li><li>\u5C06loader\u52A0\u8F7D\u5B8C\u6210\u7684module\u8FDB\u884C\u7F16\u8BD1\uFF0C\u751F\u6210AST\u6811</li><li>\u904D\u5386AST\u6811\uFF0C\u5F53\u9047\u5230require\u7B49\u4E00\u4E9B\u8C03\u7528\u8868\u8FBE\u5F0F\u65F6\uFF0C\u6536\u96C6\u4F9D\u8D56</li><li>\u6240\u6709\u4F9D\u8D56build\u5B8C\u6210\uFF0C\u5F00\u59CB\u4F18\u5316</li><li>\u8F93\u51FA\u5230dist\u76EE\u5F55</li></ol><p>WebpackOptionsApply \u5C06\u6240\u6709\u7684\u914D\u7F6Eoptions\u53C2\u6570\u8F6C\u6362\u6210 webpack\u5185\u90E8\u63D2\u4EF6 \u4F7F\u7528\u9ED8\u8BA4\u63D2\u4EF6\u5217\u8868 \u4E3E\u4F8B:</p><ul><li>outpu.library-&gt;LibraryTemplatePlugin</li><li>externals-&gt;ExternalsPlugin</li><li>devtool-&gt;EvalDevtoolModulePlugin,SourceMapDevToolPlugin</li><li>AMDPlugin,CommonJsPlugin</li><li>RemoveEmptyChunksPlugin</li></ul><p>Compiler Hooks \u6D41\u7A0B\u76F8\u5173\uFF1A</p><ul><li>before-)run</li><li>before-/after-)compile</li><li>make</li><li>after-)emit</li><li>done \u76D1\u542C\u76F8\u5173:</li><li>watch-run</li><li>watch-close</li></ul><p>Compilation Compiler\u8C03\u7528Compilation\u751F\u547D\u5468\u671F\u65B9\u6CD5</p><ul><li>addEntry -&gt; addModuleChain</li><li>finish(\u4E0A\u62A5\u6A21\u5757\u9519\u8BEF)</li><li>seal</li></ul><p>ModuleFactory</p><ul><li>NormalModuleFactory</li><li>ContextModuleFactory Module</li><li>NormalModule</li><li>ContextModule(./src/*)</li><li>ExternalModule(module.exports=jQuery)</li><li>DelegatedModule(manifest)</li></ul><p>NormalModule Build</p><ul><li>\u4F7F\u7528loader-runner\u8FD0\u884Cloaders</li><li>\u901A\u8FC7Parse\u89E3\u6790(\u5185\u90E8\u662Facron)</li><li>ParsePlugins\u6DFB\u52A0\u4F9D\u8D56</li></ul><p>Compilation hooks \u6A21\u5757\u76F8\u5173</p><ul><li>build-module</li><li>failed-module</li><li>succeed-module \u4F18\u5316\u76F8\u5173\uFF1A</li><li>after-)seal</li><li>optimize</li><li>optimize-modules(-basic/advanced)</li><li>after-optimize-modules</li><li>after-optimize-chunks</li><li>after-optimize-tree</li><li>optimize-chunk-modules(-basic/advanced)</li></ul><p>\u8D44\u6E90\u751F\u6210\u76F8\u5173\uFF1A</p><ul><li>module-asset</li><li>chunk-asset</li></ul><p>Chunk \u751F\u6210\u7B97\u6CD5</p><ol><li>webpack\u5148\u5C06entry\u4E2D\u5BF9\u5E94\u7684module\u90FD\u751F\u6210\u4E00\u4E2A\u65B0\u7684chunk</li><li>\u904D\u5386module\u7684\u4F9D\u8D56\u5217\u8868\uFF0C\u5C06\u4F9D\u8D56\u7684module\u4E5F\u52A0\u5165\u5230chunk\u4E2D</li><li>\u5982\u679C\u4E00\u4E2A\u4F9D\u8D56module\u662F\u52A8\u6001\u5F15\u5165\u7684\u6A21\u5757\uFF0C\u90A3\u4E48\u5C31\u4F1A\u6839\u636E\u8FD9\u4E2Amodule\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684chunk\uFF0C\u7EE7\u7EED\u904D\u5386\u4F9D\u8D56</li><li>\u91CD\u590D\u4E0A\u9762\u7684\u8FC7\u7A0B\u76F4\u81F3\u5F97\u5230\u6240\u6709\u7684chunks</li></ol><p>\u6A21\u5757\u5316\uFF1A\u589E\u52A0\u4EE3\u7801\u53EF\u8BFB\u6027\u548C\u7EF4\u62A4\u6027 \u4F20\u7EDF\u7684\u7F51\u9875\u5F00\u53D1\u8F6C\u53D8\u6210WebApps\u5F00\u53D1 \u4EE3\u7801\u590D\u6742\u5EA6\u5728\u9010\u6B65\u589E\u9AD8 \u5206\u79BB\u7684JS\u6587\u4EF6/\u6A21\u5757\uFF0C\u4FBF\u4E8E\u540E\u7EED\u4EE3\u7801\u7684\u7EF4\u62A4\u6027 \u90E8\u7F72\u65F6\u5E0C\u671B\u628A\u4EE3\u7801\u4F18\u5316\u6210\u51E0\u4E2AHTTP\u8BF7\u6C42</p><p>\u5E38\u89C1\u7684\u96C6\u4E2D\u6A21\u5757\u5316\u65B9\u5F0F ES module CJS AMD</p><p>AST \u57FA\u7840\u77E5\u8BC6 \u62BD\u8C61\u8BED\u6CD5\u6811(abstract syntax tree),\u6216\u8005\u8BED\u6CD5\u6811(syntax tree),\u662F\u6E90\u4EE3\u7801\u7684\u62BD\u8C61\u8BED\u6CD5\u7ED3\u6784\u7684\u6811\u72B6\u8868\u73B0\u5F62\u5F0F,\u8FD9\u91CC\u7279\u6307\u7F16\u7A0B\u8BED\u8A00\u7684\u6E90\u4EE3\u7801\uFF0C\u6811\u4E0A\u7684\u6BCF\u4E2A\u8282\u70B9\u90FD\u8868\u793A\u6E90\u4EE3\u7801\u4E2D\u7684\u4E00\u79CD\u7ED3\u6784</p><h4 id="\u590D\u4E60\u4E00\u4E0Bwebpack\u7684\u6A21\u5757\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#\u590D\u4E60\u4E00\u4E0Bwebpack\u7684\u6A21\u5757\u673A\u5236" aria-hidden="true">#</a> \u590D\u4E60\u4E00\u4E0Bwebpack\u7684\u6A21\u5757\u673A\u5236</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> installedModules<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">i</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
            <span class="token literal-property property">l</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>module<span class="token punctuation">,</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>__webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
        module<span class="token punctuation">.</span>l<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">/* 0 module */</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span>__webpack_exports__<span class="token punctuation">,</span>__webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/* 1 module */</span>

<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ul><li>\u6253\u5305\u51FA\u6765\u7684\u662F\u4E00\u4E2A IIFE\uFF08\u533F\u540D\u95ED\u5305)</li><li>modules \u662F\u4E00\u4E2A\u6570\u7EC4\uFF0C\u6BCF\u4E00\u9879\u662F\u4E00\u4E2A\u6A21\u5757\u521D\u59CB\u5316\u51FD\u6570</li><li>__webpack_require\u7528\u6765\u52A0\u8F7D\u6A21\u5757\uFF0C\u8FD4\u56DEmodule.exports</li><li>\u901A\u8FC7WEBPACK_REQUIRE_METHOD(0) \u542F\u52A8\u7A0B\u5E8F</li></ul><p>\u52A8\u624B\u5B9E\u73B0\u4E00\u4E2A\u7B80\u6613\u7684webpack</p><ol><li>\u53EF\u4EE5\u5C06ES6\u8BED\u6CD5\u8F6C\u6362\u6210ES5\u7684\u8BED\u6CD5 <ul><li>\u901A\u8FC7babylon \u751F\u6210AST</li><li>\u901A\u8FC7babel-core\u5C06AST\u91CD\u65B0\u751F\u6210\u6E90\u7801</li></ul></li><li>\u53EF\u4EE5\u5206\u6790\u6A21\u5757\u4E4B\u95F4\u7684\u4F9D\u8D56\u5173\u7CFB <ul><li>\u901A\u8FC7babel-traverse \u7684 ImportDeclaration\u65B9\u6CD5\u83B7\u53D6\u4F9D\u8D56\u5C5E\u6027</li></ul></li><li>\u751F\u6210\u7684JS\u6587\u4EF6\u53EF\u4EE5\u5728\u6D4F\u89C8\u5668\u4E2D\u8FD0\u884C</li></ol><h3 id="_07-\u7F16\u5199loader\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#_07-\u7F16\u5199loader\u63D2\u4EF6" aria-hidden="true">#</a> 07 \u7F16\u5199Loader\u63D2\u4EF6</h3><p>\u5B9A\u4E49: loader\u53EA\u662F\u4E00\u4E2A\u5BFC\u51FA\u4E3A\u51FD\u6570\u7684javascript\u6A21\u5757 <code>module.exports=function(source){ return source}</code></p><p>\u591Aloader\u65F6\u7684\u6267\u884C\u987A\u5E8F \u591A\u4E2Aloader\u4E32\u884C\u6267\u884C \u987A\u5E8F\u4ECE\u540E\u5230\u524D</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
<span class="token comment">//...</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u51FD\u6570\u7EC4\u5408\u7684\u4E24\u79CD\u60C5\u51B5 Unit\u4E2D\u7684pipline Compose\uFF08webpack\u91C7\u53D6\u7684\u662F\u8FD9\u79CD <code>compose=(f,g)=&gt;(...args)=&gt;f(g(...args));</code></p><p>\u901A\u8FC7\u4E00\u4E2A\u4F8B\u5B50\u9A8C\u8BC1 loader\u7684\u6267\u884C\u987A\u5E8F a-loader.js export=function(source){console.log(&#39;loader a is executed&#39;); return source;} b-loader.js export=function(source){console.log(&#39;loader b is executed&#39;); return source;}</p><ol start="7"><li>loader-runner\u4ECB\u7ECD \u5B9A\u4E49\uFF1Aloader-runner\u5141\u8BB8\u4F60\u5728\u4E0D\u5B89\u88C5webpack\u7684\u60C5\u51B5\u4E0B\u8FD0\u884Cloaders \u4F5C\u7528\uFF1A</li></ol><ul><li>\u4F5C\u4E3Awebpack\u7684\u4F9D\u8D56\uFF0Cwebpack\u4E2D\u4F7F\u7528\u5B83\u6267\u884Cloader</li><li>\u8FDB\u884Cloader\u7684\u5F00\u53D1\u548C\u8C03\u8BD5</li></ul><ol start="8"><li>loader-runner\u7684\u4F7F\u7528</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>runLoaders<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;loader-runner&#39;</span><span class="token punctuation">;</span>
<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token string">&#39;/abs/path/to/file.txt?query&#39;</span><span class="token punctuation">,</span> <span class="token comment">// String: \u8D44\u6E90\u7684\u7EDD\u5BF9\u8DEF\u5F84 \u53EF\u52A0query</span>
    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;/abs/path/to/loader.js?query&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// String[]:loader\u7684\u7EDD\u5BF9\u8DEF\u5F84 \u53EF\u52A0query</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">minimize</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// \u57FA\u7840\u4E0A\u4E0B\u6587\u4E4B\u5916\u989D\u5916\u7684loader\u4E0A\u4E0B\u6587</span>
    <span class="token literal-property property">readResource</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token comment">// \u8BFB\u53D6\u8D44\u6E90\u7684\u51FD\u6570</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// error: Error?</span>
    <span class="token comment">// result.result: Buffer|String</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="9"><li>\u5F00\u53D1\u4E00\u4E2Araw-loader</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/raw-loader.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> json<span class="token operator">=</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\u2028</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&#39;\\\\u2028&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\u2029</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">&#39;\\\\u2029&#39;</span><span class="token punctuation">)</span> <span class="token comment">// \u4E3A\u4E86\u5B89\u5168\u8D77\u89C1\uFF0CES\u6A21\u677F\u5B57\u7B26\u4E32\u7684\u95EE\u9898</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// src/demo.txt</span>
foobar

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="10"><li>\u4F7F\u7528loader-runner\u8C03\u8BD5loader run-loader.js</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>runLoaders<span class="token punctuation">}</span><span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;loader-runner&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token string">&#39;./demo.txt&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;./loaders/raw-loader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">readResource</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>err<span class="token operator">?</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">:</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u67E5\u770B\u8FD0\u884C\u7ED3\u679C\uFF1A node run-loader.js</p><ol start="11"><li>loader\u7684\u53C2\u6570\u83B7\u53D6 \u901A\u8FC7 loader-utils\u7684getOptions\u65B9\u6CD5\u83B7\u53D6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> loaderUtils<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;loader-utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">=</span>loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="12"><li>loader\u7684\u5F02\u5E38\u5904\u7406</li></ol><p>loader\u5185\u7F6E\u76F4\u63A5\u901A\u8FC7throw\u629B\u51FA \u901A\u8FC7this.callback\u4F20\u9012\u9519\u8BEF <code>this.callback(error: Error|null,content: string|Buffer,sourceMap?:SourceMap,meta?: any);</code> 13. loader\u7684\u5F02\u6B65\u5904\u7406 \u901A\u8FC7this.async \u6765\u8FD4\u56DE\u4E00\u4E2A\u5F02\u6B65\u51FD\u6570</p><ul><li>\u7B2C\u4E00\u4E2A\u53C2\u6570\u662FError\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u662F\u5904\u7406\u7684\u7ED3\u679C</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> callback<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// No callback=&gt; return synchronous results</span>
    <span class="token comment">// if(callback) </span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>input<span class="token operator">+</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="13"><li>\u5728loader\u4E2D\u4F7F\u7528\u7F13\u5B58 webpack\u4E2D\u9ED8\u8BA4\u5F00\u542Floader\u7F13\u5B58</li></ol><ul><li>\u53EF\u4EE5\u4F7F\u7528 this.cacheable(false) \u5173\u6389\u7F13\u5B58 \u7F13\u5B58\u6761\u4EF6: loader\u7684\u7ED3\u679C\u5728\u76F8\u540C\u7684\u8F93\u5165\u4E0B\u6709\u786E\u5B9A\u7684\u8F93\u51FA</li><li>\u6709\u4F9D\u8D56\u7684loader\u65E0\u6CD5\u4F7F\u7528\u7F13\u5B58</li></ul><ol start="14"><li>loader\u5982\u4F55\u8FDB\u884C\u6587\u4EF6\u8F93\u51FA?</li></ol><p>\u901A\u8FC7this.emitFile\u8FDB\u884C\u5199\u5165</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> loaderUtils<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;loader-utils&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">funciton</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> url<span class="token operator">=</span>loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">&#39;[hash].[ext]&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> path<span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">__webpack_public_path__+ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="\u5B9E\u6218\u5F00\u53D1\u4E00\u4E2A\u81EA\u52A8\u5408\u6210\u96EA\u78A7\u56FE\u7684loader" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u6218\u5F00\u53D1\u4E00\u4E2A\u81EA\u52A8\u5408\u6210\u96EA\u78A7\u56FE\u7684loader" aria-hidden="true">#</a> \u5B9E\u6218\u5F00\u53D1\u4E00\u4E2A\u81EA\u52A8\u5408\u6210\u96EA\u78A7\u56FE\u7684loader</h4><p>\u652F\u6301\u7684\u8BED\u6CD5:</p><ol><li><code>background: url(&#39;a.png?__sprite&#39;);</code></li><li><code>background: url(&#39;b.png?__sprite&#39;);</code> ---&gt; background: url(&#39;sprite.png&#39;); \u51C6\u5907\u77E5\u8BC6: \u5982\u4F55\u5C06\u4E24\u5F20\u56FE\u7247\u5408\u6210\u4E00\u5F20\u56FE\u7247? \u4F7F\u7528 spritesmith(https://www.npmjs.com/package/spritesmith)</li></ol><p>spritesmith\u4F7F\u7528\u793A\u4F8B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> sprites<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;./images/1.jpg&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;./images/2.jpg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Spritesmith<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">src</span><span class="token operator">:</span> sprites<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">handleResult</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// result.image;</span>
    <span class="token comment">// result.coordinates;</span>
    <span class="token comment">// result.properties;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="\u63D2\u4EF6\u7684\u8FD0\u884C\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u63D2\u4EF6\u7684\u8FD0\u884C\u73AF\u5883" aria-hidden="true">#</a> \u63D2\u4EF6\u7684\u8FD0\u884C\u73AF\u5883</h4><ol start="18"><li><p>\u63D2\u4EF6\u6CA1\u6709\u50CFloader\u90A3\u6837\u7684\u72EC\u7ACB\u8FD0\u884C\u73AF\u5883 \u53EA\u80FD\u5728webpack\u91CC\u9762\u8FD0\u884C</p></li><li><p>\u63D2\u4EF6\u7684\u57FA\u672C\u7ED3\u6784</p></li></ol>`,434);function L(O,A){const a=e("RouterLink");return o(),l(c,null,[b,n("nav",d,[n("ul",null,[n("li",null,[p(a,{to:"#original"},{default:t(()=>[m]),_:1}),n("ul",null,[n("li",null,[p(a,{to:"#concepts"},{default:t(()=>[g]),_:1})]),n("li",null,[p(a,{to:"#entry"},{default:t(()=>[y]),_:1})]),n("li",null,[p(a,{to:"#output"},{default:t(()=>[v]),_:1})]),n("li",null,[p(a,{to:"#plugins"},{default:t(()=>[h]),_:1})]),n("li",null,[p(a,{to:"#mode"},{default:t(()=>[w]),_:1})]),n("li",null,[p(a,{to:"#browser-compatibility"},{default:t(()=>[f]),_:1})]),n("li",null,[p(a,{to:"#scenarios"},{default:t(()=>[x]),_:1})]),n("li",null,[p(a,{to:"#multiple-entry-points"},{default:t(()=>[j]),_:1})])])]),n("li",null,[p(a,{to:"#webpack\u5185\u5BB9\u7EFC\u8FF0"},{default:t(()=>[_]),_:1}),n("ul",null,[n("li",null,[p(a,{to:"#_01-webpack\u4E0E\u6784\u5EFA\u53D1\u5C55\u7B80\u53F2"},{default:t(()=>[q]),_:1})]),n("li",null,[p(a,{to:"#_02-webpack\u57FA\u7840\u7528\u6CD5"},{default:t(()=>[S]),_:1})]),n("li",null,[p(a,{to:"#_03-webpack\u8FDB\u9636\u7528\u6CD5"},{default:t(()=>[C]),_:1})]),n("li",null,[p(a,{to:"#_04-\u7F16\u5199\u53EF\u7EF4\u62A4\u7684webpack\u6784\u5EFA\u914D\u7F6E"},{default:t(()=>[P]),_:1})]),n("li",null,[p(a,{to:"#_05-webpack\u6784\u5EFA\u901F\u5EA6\u548C\u4F53\u79EF\u4F18\u5316\u7B56\u7565"},{default:t(()=>[E]),_:1})]),n("li",null,[p(a,{to:"#_06-\u901A\u8FC7\u6E90\u7801\u638C\u63E1webpack\u6253\u5305\u539F\u7406"},{default:t(()=>[M]),_:1})]),n("li",null,[p(a,{to:"#_07-\u7F16\u5199loader\u63D2\u4EF6"},{default:t(()=>[N]),_:1})])])])])]),T],64)}var D=u(k,[["render",L]]);export{D as default};
